---
title: ç»“æ„å‹æ¨¡å¼
icon: javascript
order: 2
---

# ç»“æ„å‹æ¨¡å¼

ç»“æ„å‹æ¨¡å¼å…³æ³¨ç±»å’Œå¯¹è±¡çš„ç»„åˆã€‚æœ¬æ–‡å°†ä»‹ç»é€‚é…å™¨æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ã€ä»£ç†æ¨¡å¼ç­‰ç»“æ„å‹è®¾è®¡æ¨¡å¼åœ¨JavaScriptä¸­çš„å®ç°å’Œåº”ç”¨ï¼Œå¸®åŠ©æ‚¨æ„å»ºæ›´çµæ´»ã€æ›´å¯æ‰©å±•çš„ä»£ç ç»“æ„ã€‚

## é€‚é…å™¨æ¨¡å¼

é€‚é…å™¨æ¨¡å¼å…è®¸æ¥å£ä¸å…¼å®¹çš„å¯¹è±¡èƒ½å¤Ÿç›¸äº’åˆä½œï¼Œå°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·ç«¯æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£ã€‚

### åŸºæœ¬å®ç°

```javascript
// æ—§æ¥å£
class OldCalculator {
  operate(num1, num2, operation) {
    switch (operation) {
      case 'add':
        return num1 + num2;
      case 'sub':
        return num1 - num2;
      default:
        return NaN;
    }
  }
}

// æ–°æ¥å£
class NewCalculator {
  add(num1, num2) {
    return num1 + num2;
  }
  
  subtract(num1, num2) {
    return num1 - num2;
  }
  
  multiply(num1, num2) {
    return num1 * num2;
  }
  
  divide(num1, num2) {
    return num1 / num2;
  }
}

// é€‚é…å™¨
class CalculatorAdapter {
  constructor() {
    this.calculator = new NewCalculator();
  }
  
  operate(num1, num2, operation) {
    switch (operation) {
      case 'add':
        return this.calculator.add(num1, num2);
      case 'sub':
        return this.calculator.subtract(num1, num2);
      case 'mul':
        return this.calculator.multiply(num1, num2);
      case 'div':
        return this.calculator.divide(num1, num2);
      default:
        return NaN;
    }
  }
}

// å®¢æˆ·ç«¯ä»£ç 
const oldCalc = new OldCalculator();
console.log(oldCalc.operate(10, 5, 'add')); // 15

// ä½¿ç”¨é€‚é…å™¨
const adapter = new CalculatorAdapter();
console.log(adapter.operate(10, 5, 'add')); // 15
console.log(adapter.operate(10, 5, 'mul')); // 50
```

### å®é™…åº”ç”¨åœºæ™¯

```javascript
// ç¬¬ä¸‰æ–¹APIé€‚é…
class ThirdPartyAPI {
  fetchUsers() {
    return fetch('https://api.example.com/users')
      .then(response => response.json());
  }
}

// æˆ‘ä»¬çš„åº”ç”¨æœŸæœ›çš„æ¥å£
class UserService {
  getUsers() {
    // æœŸæœ›è¿”å›æ ‡å‡†æ ¼å¼çš„ç”¨æˆ·æ•°æ®
    throw new Error('æ–¹æ³•æœªå®ç°');
  }
}

// é€‚é…å™¨
class UserServiceAdapter extends UserService {
  constructor(api) {
    super();
    this.api = api;
  }
  
  async getUsers() {
    const users = await this.api.fetchUsers();
    
    // è½¬æ¢æ•°æ®æ ¼å¼
    return users.map(user => ({
      id: user.id,
      name: `${user.first_name} ${user.last_name}`,
      email: user.email,
      isActive: user.status === 'active'
    }));
  }
}

// ä½¿ç”¨é€‚é…å™¨
const api = new ThirdPartyAPI();
const userService = new UserServiceAdapter(api);

userService.getUsers()
  .then(users => console.log(users))
  .catch(error => console.error(error));
```

## è£…é¥°å™¨æ¨¡å¼

è£…é¥°å™¨æ¨¡å¼å…è®¸å‘ä¸€ä¸ªç°æœ‰çš„å¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½ï¼ŒåŒæ—¶åˆä¸æ”¹å˜å…¶ç»“æ„ã€‚

### åŸºæœ¬å®ç°

```javascript
// åŸºç¡€ç»„ä»¶
class Coffee {
  cost() {
    return 5;
  }
  
  description() {
    return 'æ™®é€šå’–å•¡';
  }
}

// è£…é¥°å™¨åŸºç±»
class CoffeeDecorator {
  constructor(coffee) {
    this.coffee = coffee;
  }
  
  cost() {
    return this.coffee.cost();
  }
  
  description() {
    return this.coffee.description();
  }
}

// å…·ä½“è£…é¥°å™¨
class MilkDecorator extends CoffeeDecorator {
  cost() {
    return this.coffee.cost() + 2;
  }
  
  description() {
    return `${this.coffee.description()}, åŠ å¥¶`;
  }
}

class SugarDecorator extends CoffeeDecorator {
  cost() {
    return this.coffee.cost() + 1;
  }
  
  description() {
    return `${this.coffee.description()}, åŠ ç³–`;
  }
}

class WhippedCreamDecorator extends CoffeeDecorator {
  cost() {
    return this.coffee.cost() + 3;
  }
  
  description() {
    return `${this.coffee.description()}, åŠ å¥¶æ²¹`;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
let coffee = new Coffee();
console.log(`${coffee.description()}: Â¥${coffee.cost()}`);
// æ™®é€šå’–å•¡: Â¥5

// åŠ å¥¶
coffee = new MilkDecorator(coffee);
console.log(`${coffee.description()}: Â¥${coffee.cost()}`);
// æ™®é€šå’–å•¡, åŠ å¥¶: Â¥7

// åŠ ç³–
coffee = new SugarDecorator(coffee);
console.log(`${coffee.description()}: Â¥${coffee.cost()}`);
// æ™®é€šå’–å•¡, åŠ å¥¶, åŠ ç³–: Â¥8

// åŠ å¥¶æ²¹
coffee = new WhippedCreamDecorator(coffee);
console.log(`${coffee.description()}: Â¥${coffee.cost()}`);
// æ™®é€šå’–å•¡, åŠ å¥¶, åŠ ç³–, åŠ å¥¶æ²¹: Â¥11
```

### ä½¿ç”¨ES7è£…é¥°å™¨

```javascript
// éœ€è¦Babelé…ç½®æ”¯æŒè£…é¥°å™¨è¯­æ³•

// æ–¹æ³•è£…é¥°å™¨
function log(target, name, descriptor) {
  const original = descriptor.value;
  
  descriptor.value = function(...args) {
    console.log(`è°ƒç”¨ ${name} æ–¹æ³•ï¼Œå‚æ•°: ${JSON.stringify(args)}`);
    const result = original.apply(this, args);
    console.log(`${name} æ–¹æ³•è¿”å›: ${JSON.stringify(result)}`);
    return result;
  };
  
  return descriptor;
}

// ç±»è£…é¥°å™¨
function singleton(constructor) {
  let instance;
  
  return function(...args) {
    if (!instance) {
      instance = new constructor(...args);
    }
    return instance;
  };
}

// ä½¿ç”¨è£…é¥°å™¨
@singleton
class UserService {
  constructor() {
    this.users = [];
  }
  
  @log
  addUser(user) {
    this.users.push(user);
    return user;
  }
  
  @log
  getUsers() {
    return this.users;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const service1 = new UserService();
const service2 = new UserService();

console.log(service1 === service2); // true

service1.addUser({ id: 1, name: 'å¼ ä¸‰' });
console.log(service2.getUsers()); // [{ id: 1, name: 'å¼ ä¸‰' }]
```

### å®é™…åº”ç”¨åœºæ™¯

```javascript
// æƒé™éªŒè¯è£…é¥°å™¨
function requireAuth(target, name, descriptor) {
  const original = descriptor.value;
  
  descriptor.value = function(...args) {
    if (!this.isAuthenticated()) {
      throw new Error('æœªæˆæƒè®¿é—®');
    }
    return original.apply(this, args);
  };
  
  return descriptor;
}

// æ€§èƒ½ç›‘æ§è£…é¥°å™¨
function measure(target, name, descriptor) {
  const original = descriptor.value;
  
  descriptor.value = function(...args) {
    const start = performance.now();
    const result = original.apply(this, args);
    const end = performance.now();
    console.log(`${name} æ‰§è¡Œæ—¶é—´: ${end - start}ms`);
    return result;
  };
  
  return descriptor;
}

// ä½¿ç”¨è£…é¥°å™¨
class API {
  constructor() {
    this.user = null;
  }
  
  login(username, password) {
    // æ¨¡æ‹Ÿç™»å½•
    this.user = { username, role: 'admin' };
  }
  
  isAuthenticated() {
    return !!this.user;
  }
  
  @requireAuth
  @measure
  fetchSensitiveData() {
    // æ¨¡æ‹ŸAPIè°ƒç”¨
    return new Promise(resolve => {
      setTimeout(() => {
        resolve({ secret: 'æ•æ„Ÿæ•°æ®' });
      }, 1000);
    });
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const api = new API();

// æœªç™»å½•æ—¶è°ƒç”¨
api.fetchSensitiveData()
  .then(data => console.log(data))
  .catch(error => console.error(error.message)); // æœªæˆæƒè®¿é—®

// ç™»å½•åè°ƒç”¨
api.login('admin', 'password');
api.fetchSensitiveData()
  .then(data => console.log(data)) // { secret: 'æ•æ„Ÿæ•°æ®' }
  .catch(error => console.error(error.message));
// fetchSensitiveData æ‰§è¡Œæ—¶é—´: 1005ms
```

## ä»£ç†æ¨¡å¼

ä»£ç†æ¨¡å¼ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚

### åŸºæœ¬å®ç°

```javascript
// åŸå§‹å¯¹è±¡
class RealImage {
  constructor(filename) {
    this.filename = filename;
    this.loadFromDisk();
  }
  
  loadFromDisk() {
    console.log(`åŠ è½½å›¾ç‰‡: ${this.filename}`);
  }
  
  display() {
    console.log(`æ˜¾ç¤ºå›¾ç‰‡: ${this.filename}`);
  }
}

// ä»£ç†å¯¹è±¡
class ProxyImage {
  constructor(filename) {
    this.filename = filename;
    this.realImage = null;
  }
  
  display() {
    if (!this.realImage) {
      this.realImage = new RealImage(this.filename);
    }
    this.realImage.display();
  }
}

// ä½¿ç”¨ç¤ºä¾‹
function run() {
  const image1 = new ProxyImage('photo1.jpg');
  const image2 = new ProxyImage('photo2.jpg');
  
  // å›¾ç‰‡1ä¼šè¢«åŠ è½½
  image1.display();
  
  // å›¾ç‰‡1ä¸ä¼šè¢«é‡æ–°åŠ è½½
  image1.display();
  
  // å›¾ç‰‡2ä¼šè¢«åŠ è½½
  image2.display();
}

run();
// åŠ è½½å›¾ç‰‡: photo1.jpg
// æ˜¾ç¤ºå›¾ç‰‡: photo1.jpg
// æ˜¾ç¤ºå›¾ç‰‡: photo1.jpg
// åŠ è½½å›¾ç‰‡: photo2.jpg
// æ˜¾ç¤ºå›¾ç‰‡: photo2.jpg
```

### ä½¿ç”¨ES6 Proxy

```javascript
// åŸå§‹å¯¹è±¡
const user = {
  name: 'å¼ ä¸‰',
  age: 30,
  _password: '123456'
};

// åˆ›å»ºä»£ç†
const userProxy = new Proxy(user, {
  get(target, property) {
    // ç¦æ­¢è®¿é—®ç§æœ‰å±æ€§
    if (property.startsWith('_')) {
      throw new Error('ç¦æ­¢è®¿é—®ç§æœ‰å±æ€§');
    }
    
    console.log(`è¯»å–å±æ€§: ${property}`);
    return target[property];
  },
  
  set(target, property, value) {
    // ç¦æ­¢ä¿®æ”¹ç§æœ‰å±æ€§
    if (property.startsWith('_')) {
      throw new Error('ç¦æ­¢ä¿®æ”¹ç§æœ‰å±æ€§');
    }
    
    // å¹´é¾„éªŒè¯
    if (property === 'age' && typeof value !== 'number') {
      throw new Error('å¹´é¾„å¿…é¡»æ˜¯æ•°å­—');
    }
    
    console.log(`è®¾ç½®å±æ€§: ${property} = ${value}`);
    target[property] = value;
    return true;
  }
});

// ä½¿ç”¨ç¤ºä¾‹
console.log(userProxy.name); // è¯»å–å±æ€§: name, å¼ ä¸‰
userProxy.age = 31; // è®¾ç½®å±æ€§: age = 31
console.log(userProxy.age); // è¯»å–å±æ€§: age, 31

try {
  console.log(userProxy._password); // æŠ›å‡ºé”™è¯¯
} catch (e) {
  console.error(e.message); // ç¦æ­¢è®¿é—®ç§æœ‰å±æ€§
}

try {
  userProxy.age = 'ä¸‰åäºŒ'; // æŠ›å‡ºé”™è¯¯
} catch (e) {
  console.error(e.message); // å¹´é¾„å¿…é¡»æ˜¯æ•°å­—
}
```

### å®é™…åº”ç”¨åœºæ™¯

```javascript
// ç¼“å­˜ä»£ç†
function createCacheProxy(fn) {
  const cache = new Map();
  
  return new Proxy(fn, {
    apply(target, thisArg, args) {
      const key = JSON.stringify(args);
      
      if (cache.has(key)) {
        console.log(`ä»ç¼“å­˜è¿”å›ç»“æœ: ${key}`);
        return cache.get(key);
      }
      
      const result = target.apply(thisArg, args);
      cache.set(key, result);
      return result;
    }
  });
}

// è€—æ—¶è®¡ç®—å‡½æ•°
function fibonacci(n) {
  if (n <= 1) return n;
  return fibonacci(n - 1) + fibonacci(n - 2);
}

// åˆ›å»ºç¼“å­˜ä»£ç†
const cachedFibonacci = createCacheProxy(fibonacci);

// ä½¿ç”¨ç¤ºä¾‹
console.time('First call');
console.log(cachedFibonacci(40));
console.timeEnd('First call');

console.time('Second call');
console.log(cachedFibonacci(40)); // ä»ç¼“å­˜è¿”å›
console.timeEnd('Second call');

// è™šæ‹Ÿä»£ç† - å›¾ç‰‡æ‡’åŠ è½½
class ImageLoader {
  loadImage(url) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.onload = () => resolve(img);
      img.onerror = reject;
      img.src = url;
    });
  }
}

class LazyImageProxy {
  constructor() {
    this.loader = new ImageLoader();
    this.cache = new Map();
  }
  
  async loadImage(url, targetElement) {
    // æ˜¾ç¤ºå ä½å›¾
    targetElement.innerHTML = '<div class="placeholder">Loading...</div>';
    
    try {
      // æ£€æŸ¥ç¼“å­˜
      if (!this.cache.has(url)) {
        const img = await this.loader.loadImage(url);
        this.cache.set(url, img);
      }
      // è·å–å›¾ç‰‡å¹¶æ˜¾ç¤º
      const img = this.cache.get(url);
      targetElement.innerHTML = '';
      targetElement.appendChild(img.cloneNode());
    } catch (error) {
      targetElement.innerHTML = '<div class="error">åŠ è½½å¤±è´¥</div>';
      console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', error);
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const lazyLoader = new LazyImageProxy();
const imageContainer = document.getElementById('image-container');

// å½“å›¾ç‰‡è¿›å…¥è§†å£æ—¶åŠ è½½
function handleIntersection(entries, observer) {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      const element = entry.target;
      const url = element.dataset.src;
      
      lazyLoader.loadImage(url, element);
      observer.unobserve(element);
    }
  });
}

// è®¾ç½®äº¤å‰è§‚å¯Ÿå™¨
const observer = new IntersectionObserver(handleIntersection);
document.querySelectorAll('[data-src]').forEach(img => {
  observer.observe(img);
});
```

## å¤–è§‚æ¨¡å¼

å¤–è§‚æ¨¡å¼ä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªç»Ÿä¸€çš„é«˜å±‚æ¥å£ï¼Œä½¿å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨ã€‚

### åŸºæœ¬å®ç°

```javascript
// å¤æ‚å­ç³»ç»Ÿ
class CPU {
  freeze() {
    console.log('CPU: å†»ç»“');
  }
  
  jump(position) {
    console.log(`CPU: è·³è½¬åˆ°ä½ç½® ${position}`);
  }
  
  execute() {
    console.log('CPU: æ‰§è¡ŒæŒ‡ä»¤');
  }
}

class Memory {
  load(position, data) {
    console.log(`å†…å­˜: åŠ è½½æ•°æ®åˆ°ä½ç½® ${position}`);
  }
}

class HardDrive {
  read(lba, size) {
    console.log(`ç¡¬ç›˜: ä»æ‰‡åŒº ${lba} è¯»å– ${size} å­—èŠ‚`);
    return 'æ•°æ®';
  }
}

// å¤–è§‚
class ComputerFacade {
  constructor() {
    this.cpu = new CPU();
    this.memory = new Memory();
    this.hardDrive = new HardDrive();
  }
  
  start() {
    console.log('è®¡ç®—æœºå¯åŠ¨å¼€å§‹...');
    this.cpu.freeze();
    this.memory.load(0, this.hardDrive.read(0, 1024));
    this.cpu.jump(0);
    this.cpu.execute();
    console.log('è®¡ç®—æœºå¯åŠ¨å®Œæˆ!');
  }
  
  shutdown() {
    console.log('è®¡ç®—æœºå…³é—­...');
    // å…³é—­å„ä¸ªå­ç³»ç»Ÿ
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const computer = new ComputerFacade();
computer.start();
// è®¡ç®—æœºå¯åŠ¨å¼€å§‹...
// CPU: å†»ç»“
// ç¡¬ç›˜: ä»æ‰‡åŒº 0 è¯»å– 1024 å­—èŠ‚
// å†…å­˜: åŠ è½½æ•°æ®åˆ°ä½ç½® 0
// CPU: è·³è½¬åˆ°ä½ç½® 0
// CPU: æ‰§è¡ŒæŒ‡ä»¤
// è®¡ç®—æœºå¯åŠ¨å®Œæˆ!
```

### å®é™…åº”ç”¨åœºæ™¯

```javascript
// å‰ç«¯APIå¤–è§‚æ¨¡å¼
class APIFacade {
  constructor(baseURL) {
    this.baseURL = baseURL;
    this.token = localStorage.getItem('token');
  }
  
  async request(endpoint, options = {}) {
    const url = `${this.baseURL}${endpoint}`;
    const headers = {
      'Content-Type': 'application/json',
      ...options.headers
    };
    
    if (this.token) {
      headers['Authorization'] = `Bearer ${this.token}`;
    }
    
    try {
      const response = await fetch(url, {
        ...options,
        headers
      });
      
      if (!response.ok) {
        throw new Error(`APIé”™è¯¯: ${response.status}`);
      }
      
      return await response.json();
    } catch (error) {
      console.error('è¯·æ±‚å¤±è´¥:', error);
      throw error;
    }
  }
  
  // ç”¨æˆ·ç›¸å…³API
  async login(username, password) {
    const data = await this.request('/auth/login', {
      method: 'POST',
      body: JSON.stringify({ username, password })
    });
    
    this.token = data.token;
    localStorage.setItem('token', data.token);
    return data;
  }
  
  async getUser(id) {
    return this.request(`/users/${id}`);
  }
  
  async updateUser(id, userData) {
    return this.request(`/users/${id}`, {
      method: 'PUT',
      body: JSON.stringify(userData)
    });
  }
  
  // äº§å“ç›¸å…³API
  async getProducts(category) {
    const endpoint = category ? `/products?category=${category}` : '/products';
    return this.request(endpoint);
  }
  
  async getProductDetails(id) {
    return this.request(`/products/${id}`);
  }
  
  // è®¢å•ç›¸å…³API
  async createOrder(orderData) {
    return this.request('/orders', {
      method: 'POST',
      body: JSON.stringify(orderData)
    });
  }
  
  async getOrders() {
    return this.request('/orders');
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const api = new APIFacade('https://api.example.com/v1');

// ç™»å½•
async function loginUser() {
  try {
    const userData = await api.login('user@example.com', 'password123');
    console.log('ç™»å½•æˆåŠŸ:', userData);
    
    // è·å–äº§å“
    const products = await api.getProducts('electronics');
    console.log('ç”µå­äº§å“:', products);
    
    // åˆ›å»ºè®¢å•
    const order = await api.createOrder({
      products: [{ id: 1, quantity: 2 }],
      shippingAddress: 'åŒ—äº¬å¸‚æµ·æ·€åŒº...'
    });
    console.log('è®¢å•åˆ›å»ºæˆåŠŸ:', order);
  } catch (error) {
    console.error('æ“ä½œå¤±è´¥:', error);
  }
}
```

## ç»„åˆæ¨¡å¼

ç»„åˆæ¨¡å¼å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤º"éƒ¨åˆ†-æ•´ä½“"çš„å±‚æ¬¡ç»“æ„ï¼Œä½¿å®¢æˆ·ç«¯å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚

### åŸºæœ¬å®ç°

```javascript
// ç»„ä»¶æ¥å£
class Component {
  constructor(name) {
    this.name = name;
  }
  
  add(component) {
    throw new Error('æ–¹æ³•æœªå®ç°');
  }
  
  remove(component) {
    throw new Error('æ–¹æ³•æœªå®ç°');
  }
  
  getChild(index) {
    throw new Error('æ–¹æ³•æœªå®ç°');
  }
  
  operation() {
    throw new Error('æ–¹æ³•æœªå®ç°');
  }
}

// å¶å­èŠ‚ç‚¹
class Leaf extends Component {
  operation() {
    return `å¶å­ ${this.name} æ“ä½œ`;
  }
}

// å¤åˆèŠ‚ç‚¹
class Composite extends Component {
  constructor(name) {
    super(name);
    this.children = [];
  }
  
  add(component) {
    this.children.push(component);
    return this;
  }
  
  remove(component) {
    const index = this.children.indexOf(component);
    if (index !== -1) {
      this.children.splice(index, 1);
    }
    return this;
  }
  
  getChild(index) {
    return this.children[index];
  }
  
  operation() {
    const results = [];
    results.push(`ç»„åˆ ${this.name} æ“ä½œå¼€å§‹`);
    
    for (const child of this.children) {
      results.push(child.operation());
    }
    
    results.push(`ç»„åˆ ${this.name} æ“ä½œç»“æŸ`);
    return results.join('\n');
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const root = new Composite('æ ¹èŠ‚ç‚¹');
const branch1 = new Composite('åˆ†æ”¯1');
const branch2 = new Composite('åˆ†æ”¯2');

const leaf1 = new Leaf('å¶å­1');
const leaf2 = new Leaf('å¶å­2');
const leaf3 = new Leaf('å¶å­3');

root.add(branch1);
root.add(branch2);

branch1.add(leaf1);
branch1.add(leaf2);
branch2.add(leaf3);

console.log(root.operation());
// ç»„åˆ æ ¹èŠ‚ç‚¹ æ“ä½œå¼€å§‹
// ç»„åˆ åˆ†æ”¯1 æ“ä½œå¼€å§‹
// å¶å­ å¶å­1 æ“ä½œ
// å¶å­ å¶å­2 æ“ä½œ
// ç»„åˆ åˆ†æ”¯1 æ“ä½œç»“æŸ
// ç»„åˆ åˆ†æ”¯2 æ“ä½œå¼€å§‹
// å¶å­ å¶å­3 æ“ä½œ
// ç»„åˆ åˆ†æ”¯2 æ“ä½œç»“æŸ
// ç»„åˆ æ ¹èŠ‚ç‚¹ æ“ä½œç»“æŸ
```

### å®é™…åº”ç”¨åœºæ™¯

```javascript
// æ–‡ä»¶ç³»ç»Ÿå®ç°
class FileSystemItem {
  constructor(name) {
    this.name = name;
  }
  
  getSize() {
    throw new Error('æ–¹æ³•æœªå®ç°');
  }
  
  print(indent = 0) {
    throw new Error('æ–¹æ³•æœªå®ç°');
  }
}

class File extends FileSystemItem {
  constructor(name, size) {
    super(name);
    this.size = size;
  }
  
  getSize() {
    return this.size;
  }
  
  print(indent = 0) {
    console.log(`${' '.repeat(indent)}ğŸ“„ ${this.name} (${this.size} bytes)`);
  }
}

class Directory extends FileSystemItem {
  constructor(name) {
    super(name);
    this.items = [];
  }
  
  add(item) {
    this.items.push(item);
    return this;
  }
  
  remove(item) {
    const index = this.items.indexOf(item);
    if (index !== -1) {
      this.items.splice(index, 1);
    }
    return this;
  }
  
  getSize() {
    return this.items.reduce((total, item) => total + item.getSize(), 0);
  }
  
  print(indent = 0) {
    console.log(`${' '.repeat(indent)}ğŸ“ ${this.name} (${this.getSize()} bytes)`);
    
    for (const item of this.items) {
      item.print(indent + 2);
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const root = new Directory('root');
const docs = new Directory('documents');
const pics = new Directory('pictures');

const resume = new File('resume.pdf', 1024);
const photo = new File('photo.jpg', 2048);
const memo = new File('memo.txt', 512);

root.add(docs).add(pics);
docs.add(resume).add(memo);
pics.add(photo);

root.print();
// ğŸ“ root (3584 bytes)
//   ğŸ“ documents (1536 bytes)
//     ğŸ“„ resume.pdf (1024 bytes)
//     ğŸ“„ memo.txt (512 bytes)
//   ğŸ“ pictures (2048 bytes)
//     ğŸ“„ photo.jpg (2048 bytes)

console.log(`æ€»å¤§å°: ${root.getSize()} bytes`);
// æ€»å¤§å°: 3584 bytes
```

## æ¡¥æ¥æ¨¡å¼

æ¡¥æ¥æ¨¡å¼å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ã€‚

### åŸºæœ¬å®ç°

```javascript
// å®ç°éƒ¨åˆ†
class DrawingAPI {
  drawCircle(x, y, radius) {
    throw new Error('æ–¹æ³•æœªå®ç°');
  }
}

class SVGDrawingAPI extends DrawingAPI {
  drawCircle(x, y, radius) {
    console.log(`SVGç»˜åˆ¶åœ†å½¢: åæ ‡(${x}, ${y}), åŠå¾„${radius}`);
  }
}

class CanvasDrawingAPI extends DrawingAPI {
  drawCircle(x, y, radius) {
    console.log(`Canvasç»˜åˆ¶åœ†å½¢: åæ ‡(${x}, ${y}), åŠå¾„${radius}`);
  }
}

// æŠ½è±¡éƒ¨åˆ†
class Shape {
  constructor(drawingAPI) {
    this.drawingAPI = drawingAPI;
  }
  
  draw() {
    throw new Error('æ–¹æ³•æœªå®ç°');
  }
  
  resizeByPercentage(percentage) {
    throw new Error('æ–¹æ³•æœªå®ç°');
  }
}

class CircleShape extends Shape {
  constructor(x, y, radius, drawingAPI) {
    super(drawingAPI);
    this.x = x;
    this.y = y;
    this.radius = radius;
  }
  
  draw() {
    this.drawingAPI.drawCircle(this.x, this.y, this.radius);
  }
  
  resizeByPercentage(percentage) {
    this.radius *= (1 + percentage / 100);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const svgCircle = new CircleShape(10, 10, 5, new SVGDrawingAPI());
const canvasCircle = new CircleShape(20, 20, 10, new CanvasDrawingAPI());

svgCircle.draw(); // SVGç»˜åˆ¶åœ†å½¢: åæ ‡(10, 10), åŠå¾„5
canvasCircle.draw(); // Canvasç»˜åˆ¶åœ†å½¢: åæ ‡(20, 20), åŠå¾„10

svgCircle.resizeByPercentage(50);
svgCircle.draw(); // SVGç»˜åˆ¶åœ†å½¢: åæ ‡(10, 10), åŠå¾„7.5
```

### å®é™…åº”ç”¨åœºæ™¯

```javascript
// ä¸»é¢˜å’Œå¹³å°æ¡¥æ¥
// å®ç°éƒ¨åˆ† - å¹³å°
class Platform {
  constructor(name) {
    this.name = name;
  }
  
  render(component, theme) {
    throw new Error('æ–¹æ³•æœªå®ç°');
  }
}

class WebPlatform extends Platform {
  constructor() {
    super('Web');
  }
  
  render(component, theme) {
    return `
      <div class="${component.toLowerCase()} ${theme.name.toLowerCase()}-theme">
        ${theme.getStyles()}
        <${component} />
      </div>
    `;
  }
}

class MobilePlatform extends Platform {
  constructor() {
    super('Mobile');
  }
  
  render(component, theme) {
    return `
      <View style="${theme.getStyles()}">
        <${component} />
      </View>
    `;
  }
}

// æŠ½è±¡éƒ¨åˆ† - ä¸»é¢˜
class Theme {
  constructor(name) {
    this.name = name;
  }
  
  getStyles() {
    throw new Error('æ–¹æ³•æœªå®ç°');
  }
}

class LightTheme extends Theme {
  constructor() {
    super('Light');
  }
  
  getStyles() {
    return 'background-color: white; color: black;';
  }
}

class DarkTheme extends Theme {
  constructor() {
    super('Dark');
  }
  
  getStyles() {
    return 'background-color: #333; color: white;';
  }
}

// ä½¿ç”¨æ¡¥æ¥æ¨¡å¼
class UIComponent {
  constructor(name, platform, theme) {
    this.name = name;
    this.platform = platform;
    this.theme = theme;
  }
  
  render() {
    return this.platform.render(this.name, this.theme);
  }
  
  changeTheme(theme) {
    this.theme = theme;
  }
  
  changePlatform(platform) {
    this.platform = platform;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const webPlatform = new WebPlatform();
const mobilePlatform = new MobilePlatform();
const lightTheme = new LightTheme();
const darkTheme = new DarkTheme();

// åˆ›å»ºWebæŒ‰é’®ï¼Œä½¿ç”¨äº®è‰²ä¸»é¢˜
const webButton = new UIComponent('Button', webPlatform, lightTheme);
console.log(webButton.render());

// åˆ‡æ¢åˆ°æš—è‰²ä¸»é¢˜
webButton.changeTheme(darkTheme);
console.log(webButton.render());

// åˆ›å»ºç§»åŠ¨ç«¯è¡¨å•ï¼Œä½¿ç”¨æš—è‰²ä¸»é¢˜
const mobileForm = new UIComponent('Form', mobilePlatform, darkTheme);
console.log(mobileForm.render());
```

## äº«å…ƒæ¨¡å¼

äº«å…ƒæ¨¡å¼é€šè¿‡å…±äº«æŠ€æœ¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡ï¼Œå‡å°‘å†…å­˜ä½¿ç”¨ã€‚

### åŸºæœ¬å®ç°

```javascript
// äº«å…ƒå¯¹è±¡
class CoffeeOrder {
  constructor(flavor) {
    this.flavor = flavor;
    // å†…éƒ¨çŠ¶æ€ï¼Œå¯ä»¥å…±äº«
  }
  
  serve(tableNumber) {
    // tableNumberæ˜¯å¤–éƒ¨çŠ¶æ€ï¼Œä¸å¯å…±äº«
    console.log(`ä¸º${tableNumber}å·æ¡Œæä¾›${this.flavor}å£å‘³çš„å’–å•¡`);
  }
}

// äº«å…ƒå·¥å‚
class CoffeeFactory {
  constructor() {
    this.coffees = {};
  }
  
  getCoffeeFlavor(flavor) {
    if (!this.coffees[flavor]) {
      this.coffees[flavor] = new CoffeeOrder(flavor);
      console.log(`åˆ›å»ºæ–°çš„${flavor}å£å‘³å’–å•¡`);
    }
    return this.coffees[flavor];
  }
  
  getTotalCoffeeCount() {
    return Object.keys(this.coffees).length;
  }
}

// å®¢æˆ·ç«¯ä»£ç 
class CoffeeShop {
  constructor() {
    this.orders = [];
    this.factory = new CoffeeFactory();
  }
  
  takeOrder(flavor, tableNumber) {
    const coffee = this.factory.getCoffeeFlavor(flavor);
    this.orders.push({ coffee, tableNumber });
  }
  
  serveAll() {
    for (const order of this.orders) {
      order.coffee.serve(order.tableNumber);
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const shop = new CoffeeShop();

// ç‚¹å’–å•¡
shop.takeOrder('æ‘©å¡', 1);
shop.takeOrder('å¡å¸ƒå¥‡è¯º', 2);
shop.takeOrder('æ‘©å¡', 3);
shop.takeOrder('é¦™è‰æ‹¿é“', 4);
shop.takeOrder('å¡å¸ƒå¥‡è¯º', 5);
shop.takeOrder('æ‘©å¡', 6);

// æä¾›æœåŠ¡
shop.serveAll();

// æŸ¥çœ‹åˆ›å»ºçš„å’–å•¡å¯¹è±¡æ•°é‡
console.log(`åˆ›å»ºçš„å’–å•¡å¯¹è±¡æ€»æ•°: ${shop.factory.getTotalCoffeeCount()}`);
// åˆ›å»ºçš„å’–å•¡å¯¹è±¡æ€»æ•°: 3
```

### å®é™…åº”ç”¨åœºæ™¯

```javascript
// æ–‡æœ¬ç¼–è¾‘å™¨ä¸­çš„å­—ç¬¦æ¸²æŸ“
class Character {
  constructor(char) {
    this.char = char;
  }
  
  render(context) {
    console.log(`æ¸²æŸ“å­—ç¬¦ '${this.char}' ${context.font}, ${context.size}pt, ä½ç½®(${context.x}, ${context.y})`);
  }
}

class CharacterFactory {
  constructor() {
    this.characters = {};
  }
  
  getCharacter(char) {
    if (!this.characters[char]) {
      this.characters[char] = new Character(char);
    }
    return this.characters[char];
  }
  
  getCount() {
    return Object.keys(this.characters).length;
  }
}

class TextEditor {
  constructor() {
    this.factory = new CharacterFactory();
    this.characters = [];
  }
  
  write(text, font, size, x, y) {
    const context = { font, size, x, y };
    
    for (let i = 0; i < text.length; i++) {
      const char = this.factory.getCharacter(text[i]);
      this.characters.push({
        character: char,
        context: { ...context, x: x + i * size / 2 }
      });
    }
  }
  
  render() {
    for (const item of this.characters) {
      item.character.render(item.context);
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const editor = new TextEditor();

editor.write('Hello', 'Arial', 12, 10, 10);
editor.write('World', 'Arial', 12, 10, 30);
editor.write('JavaScript', 'Times New Roman', 14, 10, 50);

editor.render();

console.log(`åˆ›å»ºçš„å­—ç¬¦å¯¹è±¡æ•°é‡: ${editor.factory.getCount()}`);
// åˆ›å»ºçš„å­—ç¬¦å¯¹è±¡æ•°é‡: 14 (å› ä¸ºæœ‰14ä¸ªä¸åŒçš„å­—ç¬¦)
```

## è£…é¥°æ¨¡å¼

è£…é¥°æ¨¡å¼å…è®¸å‘ä¸€ä¸ªç°æœ‰çš„å¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½ï¼ŒåŒæ—¶åˆä¸æ”¹å˜å…¶ç»“æ„ã€‚

### å‡½æ•°å¼è£…é¥°å™¨

```javascript
// å‡½æ•°å¼è£…é¥°å™¨
function readonly(target, key, descriptor) {
  descriptor.writable = false;
  return descriptor;
}

function validate(validator) {
  return function(target, key, descriptor) {
    const original = descriptor.value;
    
    descriptor.value = function(...args) {
      if (validator(...args)) {
        return original.apply(this, args);
      } else {
        throw new Error('éªŒè¯å¤±è´¥');
      }
    };
    
    return descriptor;
  };
}

// ä½¿ç”¨è£…é¥°å™¨
class User {
  constructor(name, age) {
    this.name = name;
    this.age = age;
  }
  
  @readonly
  getName() {
    return this.name;
  }
  
  @validate(age => typeof age === 'number' && age >= 0 && age <= 120)
  setAge(age) {
    this.age = age;
    return this;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const user = new User('å¼ ä¸‰', 30);

try {
  // å°è¯•è¦†ç›–åªè¯»æ–¹æ³•
  user.getName = function() { return 'hack'; };
} catch (e) {
  console.error('æ— æ³•ä¿®æ”¹åªè¯»æ–¹æ³•');
}

try {
  // æœ‰æ•ˆå¹´é¾„
  user.setAge(35);
  console.log(user.age); // 35
  
  // æ— æ•ˆå¹´é¾„
  user.setAge(-5); // æŠ›å‡ºé”™è¯¯
} catch (e) {
  console.error(e.message); // éªŒè¯å¤±è´¥
}
```

## ç»“æ„å‹æ¨¡å¼çš„é€‰æ‹©æŒ‡å—

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|----------|------|------|
| é€‚é…å™¨æ¨¡å¼ | éœ€è¦ä½¿ç”¨ç°æœ‰ç±»ï¼Œä½†æ¥å£ä¸ç¬¦åˆè¦æ±‚ | ä½¿ä¸å…¼å®¹çš„æ¥å£èƒ½å¤ŸååŒå·¥ä½œ | å¢åŠ ä»£ç å¤æ‚åº¦ |
| è£…é¥°å™¨æ¨¡å¼ | éœ€è¦åŠ¨æ€åœ°æ·»åŠ åŠŸèƒ½ï¼Œä¸”ä¸å½±å“å…¶ä»–å¯¹è±¡ | æ¯”ç»§æ‰¿æ›´çµæ´»ï¼Œå¯ä»¥åŠ¨æ€ç»„åˆ | å¯èƒ½äº§ç”Ÿå¾ˆå¤šå°å¯¹è±¡ |
| ä»£ç†æ¨¡å¼ | éœ€è¦æ§åˆ¶å¯¹å¯¹è±¡çš„è®¿é—®ï¼Œæˆ–å»¶è¿Ÿå¯¹è±¡çš„åˆ›å»º | å¯ä»¥æ§åˆ¶å¯¹åŸå¯¹è±¡çš„è®¿é—® | å¯èƒ½å¼•å…¥é¢å¤–çš„é—´æ¥å±‚ |
| å¤–è§‚æ¨¡å¼ | éœ€è¦ç®€åŒ–å¤æ‚å­ç³»ç»Ÿçš„æ¥å£ | éšè—ç³»ç»Ÿå¤æ‚æ€§ï¼Œæä¾›ç®€å•æ¥å£ | å¯èƒ½æˆä¸ºè¿‡åº¦è®¾è®¡ |
| ç»„åˆæ¨¡å¼ | éœ€è¦è¡¨ç¤ºå¯¹è±¡çš„éƒ¨åˆ†-æ•´ä½“å±‚æ¬¡ç»“æ„ | ç»Ÿä¸€å¤„ç†ç®€å•å’Œå¤æ‚å¯¹è±¡ | å¯èƒ½ä½¿è®¾è®¡å˜å¾—è¿‡äºä¸€èˆ¬åŒ– |
| æ¡¥æ¥æ¨¡å¼ | éœ€è¦å°†æŠ½è±¡ä¸å®ç°åˆ†ç¦»ï¼Œä¸”ä¸¤è€…å¯ç‹¬ç«‹å˜åŒ– | é¿å…ç±»çˆ†ç‚¸ï¼Œæé«˜å¯æ‰©å±•æ€§ | å¢åŠ ç³»ç»Ÿå¤æ‚åº¦ |
| äº«å…ƒæ¨¡å¼ | éœ€è¦æ”¯æŒå¤§é‡ç»†ç²’åº¦å¯¹è±¡ | å‡å°‘å†…å­˜ä½¿ç”¨ï¼Œæé«˜æ€§èƒ½ | å¢åŠ ç³»ç»Ÿå¤æ‚åº¦ |

## æ€»ç»“

ç»“æ„å‹è®¾è®¡æ¨¡å¼å…³æ³¨å¦‚ä½•ç»„åˆç±»å’Œå¯¹è±¡ä»¥å½¢æˆæ›´å¤§çš„ç»“æ„ï¼ŒåŒæ—¶ä¿æŒè¿™äº›ç»“æ„çš„çµæ´»æ€§å’Œé«˜æ•ˆæ€§ã€‚åœ¨JavaScriptä¸­ï¼Œè¿™äº›æ¨¡å¼å°¤å…¶æœ‰ç”¨ï¼Œå› ä¸ºJavaScriptçš„åŠ¨æ€ç‰¹æ€§å’ŒåŸå‹ç»§æ‰¿æœºåˆ¶ä½¿å¾—å¯¹è±¡ç»„åˆå˜å¾—æ›´åŠ çµæ´»ã€‚

### é€‰æ‹©åˆé€‚çš„ç»“æ„å‹æ¨¡å¼

1. **éœ€è¦è½¬æ¢æ¥å£**ï¼šä½¿ç”¨é€‚é…å™¨æ¨¡å¼
2. **éœ€è¦åŠ¨æ€æ·»åŠ åŠŸèƒ½**ï¼šä½¿ç”¨è£…é¥°å™¨æ¨¡å¼
3. **éœ€è¦æ§åˆ¶å¯¹è±¡è®¿é—®**ï¼šä½¿ç”¨ä»£ç†æ¨¡å¼
4. **éœ€è¦ç®€åŒ–å¤æ‚æ¥å£**ï¼šä½¿ç”¨å¤–è§‚æ¨¡å¼
5. **éœ€è¦ç»Ÿä¸€å¤„ç†å¯¹è±¡é›†åˆ**ï¼šä½¿ç”¨ç»„åˆæ¨¡å¼
6. **éœ€è¦åˆ†ç¦»æŠ½è±¡å’Œå®ç°**ï¼šä½¿ç”¨æ¡¥æ¥æ¨¡å¼
7. **éœ€è¦å…±äº«ç»†ç²’åº¦å¯¹è±¡**ï¼šä½¿ç”¨äº«å…ƒæ¨¡å¼

### ç°ä»£JavaScriptä¸­çš„æœ€ä½³å®è·µ

1. åˆ©ç”¨ES6 Proxyå®ç°ä»£ç†æ¨¡å¼
2. ä½¿ç”¨ES7è£…é¥°å™¨è¯­æ³•å®ç°è£…é¥°å™¨æ¨¡å¼
3. ç»“åˆå‡½æ•°å¼ç¼–ç¨‹æ€æƒ³å®ç°ç»“æ„å‹æ¨¡å¼
4. åˆ©ç”¨æ¨¡å—ç³»ç»Ÿå®ç°å¤–è§‚æ¨¡å¼
5. ä½¿ç”¨ç»„åˆä¼˜äºç»§æ‰¿çš„åŸåˆ™

ç»“æ„å‹æ¨¡å¼ä¸ä»…ä»…æ˜¯ç†è®ºæ¦‚å¿µï¼Œå®ƒä»¬åœ¨å®é™…JavaScriptåº”ç”¨å¼€å‘ä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ã€‚é€šè¿‡åˆç†é€‰æ‹©å’Œåº”ç”¨è¿™äº›æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™å‡ºæ›´åŠ çµæ´»ã€å¯ç»´æŠ¤å’Œå¯æ‰©å±•çš„ä»£ç ç»“æ„ã€‚

## å‚è€ƒèµ„æº

- [Design Patterns: Elements of Reusable Object-Oriented Software](https://www.amazon.com/Design-Patterns-Elements-Reusable-Object-Oriented/dp/0201633612)
- [JavaScriptè®¾è®¡æ¨¡å¼ä¸å¼€å‘å®è·µ](https://book.douban.com/subject/26382780/)
- [Addy Osmaniçš„JavaScriptè®¾è®¡æ¨¡å¼](https://addyosmani.com/resources/essentialjsdesignpatterns/book/)
- [MDN Webæ–‡æ¡£ - JavaScript](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript)