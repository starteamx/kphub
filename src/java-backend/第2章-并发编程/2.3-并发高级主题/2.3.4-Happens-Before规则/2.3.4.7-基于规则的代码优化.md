---
title: 基于规则的代码优化
icon: optimize
order: 7
---

# 基于规则的代码优化

## 减少不必要的同步

- 识别无共享数据的线程本地操作
- 使用ThreadLocal避免共享
- 采用不可变对象消除同步需求
- 合理使用volatile替代synchronized

## 细化锁粒度

- 将大锁拆分为多个小锁
- 使用读写锁分离读写操作
- 采用分段锁技术(如ConcurrentHashMap)
- 使用StampedLock提高读操作并发性

## 避免常见陷阱

- 正确发布对象避免部分构造
- 安全使用延迟初始化
- 避免在锁内执行耗时操作
- 防止锁顺序不一致导致死锁

## 性能与正确性平衡

- 使用无锁数据结构提高并发性
- 采用乐观锁减少阻塞
- 合理使用原子变量类
- 基于内存屏障的细粒度同步
