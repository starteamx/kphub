---
title: 三色标记基本原理
icon: principle
order: 2
---

# 三色标记基本原理

## 三色标记的数据结构
- 三色集合的实现方式
- 对象颜色的存储策略
- 灰色集合的高效实现
- 标记位与对象头的关系

## 标记阶段详解
- 初始标记(Initial Mark)：根对象标记
- 并发标记(Concurrent Mark)：主体标记过程
- 再标记(Remark)：处理并发标记期间的变化
- 标记完成(Mark Completion)：最终状态确认

## 对象状态转换
- 白色→灰色：对象被发现
- 灰色→黑色：对象被完全扫描
- 特殊情况下的状态回退
- 状态转换的原子性保证

## 并发标记的挑战
- 应用程序与GC线程并发执行
- 对象引用关系的动态变化
- 新分配对象的处理策略
- 对象提前释放的风险

## 三色标记的基本实现
- 单线程实现示例
- 多线程并行标记策略
- 工作窃取(Work Stealing)机制
- 标记队列的负载均衡
