---
title: ç½‘ç»œè¯·æ±‚å·¥å…·
icon: cloud
order: 3
---

# ç½‘ç»œè¯·æ±‚å·¥å…·

åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œç½‘ç»œè¯·æ±‚æ˜¯è¿æ¥å‰ç«¯åº”ç”¨ä¸åç«¯æœåŠ¡çš„å…³é”®æ¡¥æ¢ã€‚Vueåº”ç”¨éœ€è¦é«˜æ•ˆã€å¯é çš„ç½‘ç»œè¯·æ±‚å·¥å…·æ¥å¤„ç†æ•°æ®è·å–ã€æäº¤å’ŒåŒæ­¥ç­‰æ“ä½œã€‚æœ¬ç« å°†è¯¦ç»†ä»‹ç»å‡ ç§ä¸»æµçš„ç½‘ç»œè¯·æ±‚è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬Axiosã€Fetch APIä»¥åŠGraphQLå®¢æˆ·ç«¯ï¼Œå¹¶æ¢è®¨å®ƒä»¬åœ¨Vueåº”ç”¨ä¸­çš„æœ€ä½³å®è·µã€‚

## Axiosä¸Vueé›†æˆ

Axiosæ˜¯ä¸€ä¸ªåŸºäºPromiseçš„HTTPå®¢æˆ·ç«¯ï¼Œå¯ä»¥ç”¨äºæµè§ˆå™¨å’ŒNode.jsç¯å¢ƒã€‚å®ƒæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½ï¼Œå¦‚æ‹¦æˆªè¯·æ±‚å’Œå“åº”ã€è½¬æ¢è¯·æ±‚å’Œå“åº”æ•°æ®ã€è‡ªåŠ¨è½¬æ¢JSONæ•°æ®ã€å®¢æˆ·ç«¯é˜²å¾¡XSRFç­‰ã€‚åœ¨Vueé¡¹ç›®ä¸­ï¼ŒAxiosæ˜¯æœ€å¸¸ç”¨çš„ç½‘ç»œè¯·æ±‚åº“ä¹‹ä¸€ã€‚

### åŸºç¡€é…ç½®ä¸ä½¿ç”¨

é¦–å…ˆï¼Œå®‰è£…Axiosï¼š

```bash
npm install axios
```

#### åˆ›å»ºAxioså®ä¾‹

åœ¨Vueé¡¹ç›®ä¸­ï¼Œé€šå¸¸ä¼šåˆ›å»ºä¸€ä¸ªAxioså®ä¾‹ï¼Œå¹¶è¿›è¡ŒåŸºç¡€é…ç½®ï¼š

```javascript
// src/utils/request.js
import axios from 'axios'

// åˆ›å»ºAxioså®ä¾‹
const request = axios.create({
  // APIçš„åŸºç¡€URLï¼Œå¯ä»¥ä»ç¯å¢ƒå˜é‡ä¸­è·å–
  baseURL: import.meta.env.VITE_API_BASE_URL || '/api',
  // è¯·æ±‚è¶…æ—¶æ—¶é—´
  timeout: 15000,
  // è¯·æ±‚å¤´è®¾ç½®
  headers: {
    'Content-Type': 'application/json'
  }
})

export default request
```

#### åœ¨Vueç»„ä»¶ä¸­ä½¿ç”¨

åœ¨Vueç»„ä»¶ä¸­ä½¿ç”¨Axioså‘èµ·è¯·æ±‚ï¼š

```vue
<script setup>
import { ref, onMounted } from 'vue'
import request from '@/utils/request'

const users = ref([])
const loading = ref(false)
const error = ref(null)

// è·å–ç”¨æˆ·åˆ—è¡¨
const fetchUsers = async () => {
  loading.value = true
  error.value = null
  
  try {
    const response = await request.get('/users')
    users.value = response.data
  } catch (err) {
    error.value = err.message || 'è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥'
    console.error('è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥:', err)
  } finally {
    loading.value = false
  }
}

// åˆ›å»ºæ–°ç”¨æˆ·
const createUser = async (userData) => {
  try {
    const response = await request.post('/users', userData)
    // æ·»åŠ åˆ°ç”¨æˆ·åˆ—è¡¨
    users.value.push(response.data)
    return response.data
  } catch (err) {
    error.value = err.message || 'åˆ›å»ºç”¨æˆ·å¤±è´¥'
    console.error('åˆ›å»ºç”¨æˆ·å¤±è´¥:', err)
    throw err
  }
}

onMounted(() => {
  fetchUsers()
})
</script>

<template>
  <div>
    <div v-if="loading">åŠ è½½ä¸­...</div>
    <div v-else-if="error" class="error">{{ error }}</div>
    <ul v-else>
      <li v-for="user in users" :key="user.id">
        {{ user.name }} ({{ user.email }})
      </li>
    </ul>
  </div>
</template>
```

### è¯·æ±‚æ‹¦æˆªå™¨é…ç½®

è¯·æ±‚æ‹¦æˆªå™¨å…è®¸åœ¨è¯·æ±‚å‘é€å‰å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä¾‹å¦‚æ·»åŠ è®¤è¯ä»¤ç‰Œã€ä¿®æ”¹è¯·æ±‚å¤´æˆ–å‚æ•°ç­‰ã€‚

```javascript
// src/utils/request.js
import axios from 'axios'
import { useAuthStore } from '@/stores/auth'

const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || '/api',
  timeout: 15000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// è¯·æ±‚æ‹¦æˆªå™¨
request.interceptors.request.use(
  config => {
    // è·å–è®¤è¯çŠ¶æ€
    const authStore = useAuthStore()
    
    // å¦‚æœæœ‰tokenï¼Œæ·»åŠ åˆ°è¯·æ±‚å¤´
    if (authStore.token) {
      config.headers.Authorization = `Bearer ${authStore.token}`
    }
    
    // æ·»åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜ï¼ˆä»…GETè¯·æ±‚ï¼‰
    if (config.method === 'get') {
      config.params = {
        ...config.params,
        _t: Date.now()
      }
    }
    
    // æ—¥å¿—è®°å½•
    console.log(`[API Request] ${config.method.toUpperCase()} ${config.url}`, config)
    
    return config
  },
  error => {
    // è¯·æ±‚é”™è¯¯å¤„ç†
    console.error('[API Request Error]', error)
    return Promise.reject(error)
  }
)
```

#### é«˜çº§è¯·æ±‚æ‹¦æˆªå™¨

åœ¨å¤æ‚åº”ç”¨ä¸­ï¼Œå¯èƒ½éœ€è¦æ›´é«˜çº§çš„è¯·æ±‚æ‹¦æˆªåŠŸèƒ½ï¼Œå¦‚è¯·æ±‚é‡è¯•ã€è¯·æ±‚é˜Ÿåˆ—æˆ–è¯·æ±‚å–æ¶ˆï¼š

```javascript
// src/utils/request.js
import axios from 'axios'
import { useAuthStore } from '@/stores/auth'
import { useLoadingStore } from '@/stores/loading'

// åˆ›å»ºAxioså®ä¾‹
const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || '/api',
  timeout: 15000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// å­˜å‚¨å–æ¶ˆä»¤ç‰Œçš„Map
const pendingRequests = new Map()

// ç”Ÿæˆè¯·æ±‚çš„å”¯ä¸€é”®
const generateRequestKey = config => {
  const { url, method, params, data } = config
  return [url, method, JSON.stringify(params), JSON.stringify(data)].join('&')
}

// æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨
request.interceptors.request.use(
  config => {
    // è·å–è®¤è¯çŠ¶æ€å’ŒåŠ è½½çŠ¶æ€
    const authStore = useAuthStore()
    const loadingStore = useLoadingStore()
    
    // å¦‚æœæœ‰tokenï¼Œæ·»åŠ åˆ°è¯·æ±‚å¤´
    if (authStore.token) {
      config.headers.Authorization = `Bearer ${authStore.token}`
    }
    
    // åˆ›å»ºå–æ¶ˆä»¤ç‰Œ
    const controller = new AbortController()
    config.signal = controller.signal
    
    // ç”Ÿæˆè¯·æ±‚é”®
    const requestKey = generateRequestKey(config)
    
    // å¦‚æœå­˜åœ¨ç›¸åŒçš„è¯·æ±‚ï¼Œå–æ¶ˆä¹‹å‰çš„è¯·æ±‚
    if (config.cancelDuplicate && pendingRequests.has(requestKey)) {
      const previousController = pendingRequests.get(requestKey)
      previousController.abort()
      console.log(`[API] å–æ¶ˆé‡å¤è¯·æ±‚: ${config.url}`)
    }
    
    // å­˜å‚¨å½“å‰è¯·æ±‚çš„å–æ¶ˆæ§åˆ¶å™¨
    pendingRequests.set(requestKey, controller)
    
    // å¦‚æœé…ç½®äº†è‡ªåŠ¨æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    if (config.showLoading !== false) {
      loadingStore.addLoading(config.loadingKey || 'global')
    }
    
    // æ·»åŠ è¯·æ±‚æ—¶é—´æˆ³
    config._requestTime = Date.now()
    
    return config
  },
  error => {
    return Promise.reject(error)
  }
)
```

### å“åº”å¤„ç†æœ€ä½³å®è·µ

å“åº”æ‹¦æˆªå™¨å…è®¸åœ¨æ¥æ”¶åˆ°å“åº”åå¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚ç»Ÿä¸€å¤„ç†å“åº”æ ¼å¼ã€æå–æ•°æ®ã€å¤„ç†é”™è¯¯ç­‰ã€‚

```javascript
// src/utils/request.js
// ... å‰é¢çš„ä»£ç 

// å“åº”æ‹¦æˆªå™¨
request.interceptors.response.use(
  response => {
    // è·å–åŠ è½½çŠ¶æ€
    const loadingStore = useLoadingStore()
    
    // è¯·æ±‚å®Œæˆï¼Œç§»é™¤å–æ¶ˆä»¤ç‰Œ
    const requestKey = generateRequestKey(response.config)
    pendingRequests.delete(requestKey)
    
    // éšè—åŠ è½½çŠ¶æ€
    if (response.config.showLoading !== false) {
      loadingStore.removeLoading(response.config.loadingKey || 'global')
    }
    
    // è®¡ç®—è¯·æ±‚è€—æ—¶
    const requestTime = Date.now() - response.config._requestTime
    console.log(`[API Response] ${response.config.method.toUpperCase()} ${response.config.url} (${requestTime}ms)`, response.data)
    
    // å¤„ç†è‡ªå®šä¹‰å“åº”æ ¼å¼
    // å‡è®¾åç«¯è¿”å›æ ¼å¼ä¸º { code: 0, data: {}, message: '' }
    const res = response.data
    
    if (res.code !== undefined) {
      // å¦‚æœåç«¯å®šä¹‰äº†ä¸šåŠ¡çŠ¶æ€ç 
      if (res.code === 0) {
        // ä¸šåŠ¡æˆåŠŸï¼Œè¿”å›æ•°æ®
        return res.data
      } else {
        // ä¸šåŠ¡å¤±è´¥ï¼ŒæŠ›å‡ºé”™è¯¯
        const error = new Error(res.message || 'è¯·æ±‚å¤±è´¥')
        error.code = res.code
        error.data = res.data
        error.response = response
        
        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
        if (response.config.showError !== false) {
          // ä½¿ç”¨UIåº“çš„æ¶ˆæ¯æç¤º
          // ä¾‹å¦‚ï¼šElMessage.error(res.message || 'è¯·æ±‚å¤±è´¥')
        }
        
        return Promise.reject(error)
      }
    }
    
    // å¦‚æœåç«¯æ²¡æœ‰å®šä¹‰ä¸šåŠ¡çŠ¶æ€ç ï¼Œç›´æ¥è¿”å›æ•°æ®
    return response.data
  },
  error => {
    // è·å–åŠ è½½çŠ¶æ€
    const loadingStore = useLoadingStore()
    
    // å¦‚æœè¯·æ±‚å·²è¢«å–æ¶ˆï¼Œä¸åšå¤„ç†
    if (axios.isCancel(error)) {
      console.log('[API] è¯·æ±‚å·²å–æ¶ˆ:', error.message)
      return Promise.reject(error)
    }
    
    // è¯·æ±‚é…ç½®
    const config = error.config
    
    // éšè—åŠ è½½çŠ¶æ€
    if (config && config.showLoading !== false) {
      loadingStore.removeLoading(config.loadingKey || 'global')
    }
    
    // ä»pendingRequestsä¸­ç§»é™¤
    if (config) {
      const requestKey = generateRequestKey(config)
      pendingRequests.delete(requestKey)
    }
    
    // å¤„ç†é”™è¯¯
    console.error('[API Response Error]', error)
    
    // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
    if (config && config.showError !== false) {
      // ä½¿ç”¨UIåº“çš„æ¶ˆæ¯æç¤º
      // ä¾‹å¦‚ï¼šElMessage.error(error.message || 'ç½‘ç»œè¯·æ±‚å¤±è´¥')
    }
    
    return Promise.reject(error)
  }
)
```

#### å“åº”æ•°æ®è½¬æ¢

æœ‰æ—¶éœ€è¦å¯¹å“åº”æ•°æ®è¿›è¡Œè½¬æ¢ï¼Œä¾‹å¦‚æ—¥æœŸæ ¼å¼åŒ–ã€æ•°æ®ç»“æ„è°ƒæ•´ç­‰ï¼š

```javascript
// src/utils/request.js
// ... å‰é¢çš„ä»£ç 

// æ·»åŠ å“åº”è½¬æ¢å™¨
request.defaults.transformResponse = [
  ...axios.defaults.transformResponse,
  data => {
    // å¦‚æœä¸æ˜¯å¯¹è±¡ï¼Œç›´æ¥è¿”å›
    if (!data || typeof data !== 'object') return data
    
    // é€’å½’å¤„ç†å¯¹è±¡ä¸­çš„æ—¥æœŸå­—ç¬¦ä¸²
    const transformDate = (obj) => {
      if (!obj || typeof obj !== 'object') return obj
      
      for (const key in obj) {
        const value = obj[key]
        
        // æ£€æŸ¥æ˜¯å¦æ˜¯æ—¥æœŸå­—ç¬¦ä¸²ï¼ˆISO 8601æ ¼å¼ï¼‰
        if (typeof value === 'string' && /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/.test(value)) {
          obj[key] = new Date(value)
        } else if (typeof value === 'object') {
          // é€’å½’å¤„ç†åµŒå¥—å¯¹è±¡
          transformDate(value)
        }
      }
      
      return obj
    }
    
    return transformDate(data)
  }
]
```

### é”™è¯¯å¤„ç†ç­–ç•¥

æœ‰æ•ˆçš„é”™è¯¯å¤„ç†å¯¹äºæå‡ç”¨æˆ·ä½“éªŒè‡³å…³é‡è¦ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„é”™è¯¯å¤„ç†ç­–ç•¥ï¼š

#### å…¨å±€é”™è¯¯å¤„ç†

```javascript
// src/utils/request.js
// ... å‰é¢çš„ä»£ç 

// é”™è¯¯å¤„ç†å‡½æ•°
const handleError = (error) => {
  const authStore = useAuthStore()
  const router = useRouter()
  
  // è·å–é”™è¯¯ä¿¡æ¯
  let message = error.message || 'è¯·æ±‚å¤±è´¥'
  
  // æ ¹æ®HTTPçŠ¶æ€ç å¤„ç†é”™è¯¯
  if (error.response) {
    const status = error.response.status
    
    switch (status) {
      case 400:
        message = 'è¯·æ±‚é”™è¯¯'
        break
      case 401:
        message = 'æœªæˆæƒï¼Œè¯·ç™»å½•'
        // æ¸…é™¤tokenå¹¶è·³è½¬åˆ°ç™»å½•é¡µ
        authStore.logout()
        router.push('/login')
        break
      case 403:
        message = 'æ‹’ç»è®¿é—®'
        break
      case 404:
        message = 'è¯·æ±‚åœ°å€ä¸å­˜åœ¨'
        break
      case 408:
        message = 'è¯·æ±‚è¶…æ—¶'
        break
      case 500:
        message = 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
        break
      case 501:
        message = 'æœåŠ¡æœªå®ç°'
        break
      case 502:
        message = 'ç½‘å…³é”™è¯¯'
        break
      case 503:
        message = 'æœåŠ¡ä¸å¯ç”¨'
        break
      case 504:
        message = 'ç½‘å…³è¶…æ—¶'
        break
      default:
        message = `æœªçŸ¥é”™è¯¯(${status})`
    }
    
    // å°è¯•ä»å“åº”ä¸­è·å–æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
    if (error.response.data && error.response.data.message) {
      message = error.response.data.message
    }
  } else if (error.request) {
    // è¯·æ±‚å·²å‘é€ä½†æœªæ”¶åˆ°å“åº”
    message = 'ç½‘ç»œå¼‚å¸¸ï¼ŒæœåŠ¡å™¨æœªå“åº”'
  }
  
  // è®¾ç½®é”™è¯¯ä¿¡æ¯
  error.displayMessage = message
  
  return error
}

// åœ¨å“åº”æ‹¦æˆªå™¨ä¸­ä½¿ç”¨
request.interceptors.response.use(
  response => {
    // ... æˆåŠŸå¤„ç†ä»£ç 
  },
  error => {
    // å¤„ç†é”™è¯¯
    error = handleError(error)
    
    // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
    if (error.config && error.config.showError !== false) {
      // ä½¿ç”¨UIåº“çš„æ¶ˆæ¯æç¤º
      // ä¾‹å¦‚ï¼šElMessage.error(error.displayMessage)
    }
    
    return Promise.reject(error)
  }
)
```

#### è¯·æ±‚é‡è¯•æœºåˆ¶

å¯¹äºå› ç½‘ç»œé—®é¢˜å¯¼è‡´çš„è¯·æ±‚å¤±è´¥ï¼Œå¯ä»¥å®ç°è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼š

```javascript
// src/utils/request.js
// ... å‰é¢çš„ä»£ç 

// è¯·æ±‚é‡è¯•æ‹¦æˆªå™¨
request.interceptors.response.use(
  response => response,
  async error => {
    // è·å–åŸå§‹è¯·æ±‚é…ç½®
    const config = error.config
    
    // å¦‚æœæ²¡æœ‰é…ç½®æˆ–å·²ç»é‡è¯•è¿‡ï¼Œç›´æ¥æ‹’ç»
    if (!config || !config.retry) return Promise.reject(error)
    
    // è®¾ç½®é‡è¯•è®¡æ•°å™¨
    config.__retryCount = config.__retryCount || 0
    
    // æ£€æŸ¥æ˜¯å¦å·²è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°
    if (config.__retryCount >= config.retry) {
      return Promise.reject(error)
    }
    
    // å¢åŠ é‡è¯•è®¡æ•°
    config.__retryCount += 1
    
    console.log(`[API] é‡è¯•è¯·æ±‚ (${config.__retryCount}/${config.retry}): ${config.url}`)
    
    // åˆ›å»ºå»¶è¿ŸPromise
    const delay = ms => new Promise(resolve => setTimeout(resolve, ms))
    
    // ç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•
    // å¯ä»¥ä½¿ç”¨æŒ‡æ•°é€€é¿ç­–ç•¥å¢åŠ é‡è¯•é—´éš”
    const retryDelay = config.retryDelay || 1000
    const exponentialDelay = retryDelay * Math.pow(2, config.__retryCount - 1)
    
    await delay(exponentialDelay)
    
    // é‡æ–°å‘é€è¯·æ±‚
    return request(config)
  }
)

// ä½¿ç”¨é‡è¯•æœºåˆ¶çš„è¯·æ±‚ç¤ºä¾‹
const fetchWithRetry = () => {
  return request.get('/users', {
    retry: 3,        // æœ€å¤§é‡è¯•æ¬¡æ•°
    retryDelay: 1000 // åˆå§‹é‡è¯•å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
  })
}
```

#### è¯·æ±‚å–æ¶ˆ

Axiosæ”¯æŒä½¿ç”¨AbortControllerå–æ¶ˆè¯·æ±‚ï¼Œè¿™åœ¨ç”¨æˆ·å¿«é€Ÿåˆ‡æ¢é¡µé¢æˆ–ç»„ä»¶å¸è½½æ—¶ç‰¹åˆ«æœ‰ç”¨ï¼š

```javascript
// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
<script setup>
import { ref, onMounted, onUnmounted } from 'vue'
import request from '@/utils/request'

const data = ref(null)
const loading = ref(false)
const error = ref(null)

// åˆ›å»ºAbortController
const controller = new AbortController()

const fetchData = async () => {
  loading.value = true
  error.value = null
  
  try {
    const response = await request.get('/api/data', {
      signal: controller.signal // ä¼ é€’å–æ¶ˆä¿¡å·
    })
    data.value = response
  } catch (err) {
    if (axios.isCancel(err)) {
      console.log('è¯·æ±‚å·²å–æ¶ˆ')
    } else {
      error.value = err.message
      console.error('è·å–æ•°æ®å¤±è´¥:', err)
    }
  } finally {
    loading.value = false
  }
}

onMounted(() => {
  fetchData()
})

onUnmounted(() => {
  // ç»„ä»¶å¸è½½æ—¶å–æ¶ˆè¯·æ±‚
  controller.abort()
})
</script>
```

### å°è£…APIæœåŠ¡

ä¸ºäº†æ›´å¥½åœ°ç»„ç»‡APIè°ƒç”¨ï¼Œé€šå¸¸ä¼šå°†ç›¸å…³çš„APIè¯·æ±‚å°è£…åˆ°æœåŠ¡æ¨¡å—ä¸­ï¼š

```javascript
// src/api/user.js
import request from '@/utils/request'

export const userApi = {
  /**
   * è·å–ç”¨æˆ·åˆ—è¡¨
   * @param {Object} params - æŸ¥è¯¢å‚æ•°
   * @returns {Promise<Array>} ç”¨æˆ·åˆ—è¡¨
   */
  getUsers(params) {
    return request.get('/users', { params })
  },
  
  /**
   * è·å–ç”¨æˆ·è¯¦æƒ…
   * @param {string|number} id - ç”¨æˆ·ID
   * @returns {Promise<Object>} ç”¨æˆ·è¯¦æƒ…
   */
  getUserById(id) {
    return request.get(`/users/${id}`)
  },
  
  /**
   * åˆ›å»ºç”¨æˆ·
   * @param {Object} data - ç”¨æˆ·æ•°æ®
   * @returns {Promise<Object>} åˆ›å»ºçš„ç”¨æˆ·
   */
  createUser(data) {
    return request.post('/users', data)
  },
  
  /**
   * æ›´æ–°ç”¨æˆ·
   * @param {string|number} id - ç”¨æˆ·ID
   * @param {Object} data - æ›´æ–°çš„ç”¨æˆ·æ•°æ®
   * @returns {Promise<Object>} æ›´æ–°åçš„ç”¨æˆ·
   */
  updateUser(id, data) {
    return request.put(`/users/${id}`, data)
  },
  
  /**
   * åˆ é™¤ç”¨æˆ·
   * @param {string|number} id - ç”¨æˆ·ID
   * @returns {Promise<void>}
   */
  deleteUser(id) {
    return request.delete(`/users/${id}`)
  }
}
```

åœ¨ç»„ä»¶ä¸­ä½¿ç”¨APIæœåŠ¡ï¼š

```vue
<script setup>
import { ref, onMounted } from 'vue'
import { userApi } from '@/api/user'

const users = ref([])
const loading = ref(false)
const error = ref(null)

const fetchUsers = async () => {
  loading.value = true
  error.value = null
  
  try {
    users.value = await userApi.getUsers()
  } catch (err) {
    error.value = err.displayMessage || 'è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥'
  } finally {
    loading.value = false
  }
}

onMounted(() => {
  fetchUsers()
})
</script>
```

## Fetch APIå°è£…

Fetch APIæ˜¯ç°ä»£æµè§ˆå™¨æä¾›çš„åŸç”Ÿç½‘ç»œè¯·æ±‚æ¥å£ï¼Œç›¸æ¯”XMLHttpRequestæ›´ç®€æ´ã€æ›´å¼ºå¤§ã€‚ç„¶è€Œï¼ŒåŸç”ŸFetch APIç›¸å¯¹ç®€å•ï¼Œç¼ºå°‘ä¸€äº›Axiosæä¾›çš„é«˜çº§åŠŸèƒ½ï¼Œå¦‚æ‹¦æˆªå™¨ã€è‡ªåŠ¨è½¬æ¢JSONç­‰ã€‚å› æ­¤ï¼Œé€šå¸¸éœ€è¦å¯¹Fetch APIè¿›è¡Œå°è£…ï¼Œä»¥æä¾›æ›´ä¾¿æ·çš„ä½¿ç”¨ä½“éªŒã€‚

### åŸºäºFetchçš„è¯·æ±‚åº“

ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºäºFetch APIçš„ç®€å•è¯·æ±‚åº“å°è£…ï¼š

```javascript
// src/utils/fetchRequest.js
import { useAuthStore } from '@/stores/auth'

/**
 * åŸºäºFetch APIçš„è¯·æ±‚åº“
 */
class FetchRequest {
  constructor(baseURL = '') {
    this.baseURL = baseURL
    this.defaultConfig = {
      headers: {
        'Content-Type': 'application/json'
      },
      credentials: 'same-origin', // åŒ…å«cookies
      timeout: 15000, // è¶…æ—¶æ—¶é—´
      showError: true, // æ˜¯å¦æ˜¾ç¤ºé”™è¯¯
      showLoading: true // æ˜¯å¦æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    }
  }
  
  /**
   * å‘é€è¯·æ±‚
   * @param {string} url - è¯·æ±‚URL
   * @param {Object} options - è¯·æ±‚é€‰é¡¹
   * @returns {Promise} å“åº”Promise
   */
  async request(url, options = {}) {
    // åˆå¹¶é…ç½®
    const config = {
      ...this.defaultConfig,
      ...options,
      headers: {
        ...this.defaultConfig.headers,
        ...options.headers
      }
    }
    
    // æ„å»ºå®Œæ•´URL
    const fullUrl = this._buildUrl(url, config.params)
    
    // å¤„ç†è¯·æ±‚ä½“
    if (config.body && typeof config.body === 'object') {
      config.body = JSON.stringify(config.body)
    }
    
    // æ·»åŠ è®¤è¯å¤´
    this._addAuthHeader(config)
    
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    if (config.showLoading) {
      this._showLoading(config.loadingKey)
    }
    
    // åˆ›å»ºAbortControllerç”¨äºè¶…æ—¶æ§åˆ¶
    const controller = new AbortController()
    config.signal = controller.signal
    
    // è®¾ç½®è¶…æ—¶
    const timeoutId = setTimeout(() => {
      controller.abort()
    }, config.timeout)
    
    try {
      // å‘é€è¯·æ±‚
      const response = await fetch(fullUrl, config)
      
      // æ¸…é™¤è¶…æ—¶
      clearTimeout(timeoutId)
      
      // éšè—åŠ è½½çŠ¶æ€
      if (config.showLoading) {
        this._hideLoading(config.loadingKey)
      }
      
      // å¤„ç†å“åº”
      return await this._handleResponse(response, config)
    } catch (error) {
      // æ¸…é™¤è¶…æ—¶
      clearTimeout(timeoutId)
      
      // éšè—åŠ è½½çŠ¶æ€
      if (config.showLoading) {
        this._hideLoading(config.loadingKey)
      }
      
      // å¤„ç†é”™è¯¯
      return this._handleError(error, config)
    }
  }
  
  /**
   * æ„å»ºURLï¼ˆæ·»åŠ æŸ¥è¯¢å‚æ•°ï¼‰
   * @private
   */
  _buildUrl(url, params) {
    // æ„å»ºå®Œæ•´URL
    const fullUrl = url.startsWith('http') ? url : `${this.baseURL}${url}`
    
    // å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œç›´æ¥è¿”å›
    if (!params) return fullUrl
    
    // æ„å»ºURLå¯¹è±¡
    const urlObj = new URL(fullUrl)
    
    // æ·»åŠ æŸ¥è¯¢å‚æ•°
    Object.entries(params).forEach(([key, value]) => {
      urlObj.searchParams.append(key, value)
    })
    
    return urlObj.toString()
  }
  
  /**
   * æ·»åŠ è®¤è¯å¤´
   * @private
   */
  _addAuthHeader(config) {
    const authStore = useAuthStore()
    
    if (authStore.token) {
      config.headers.Authorization = `Bearer ${authStore.token}`
    }
  }
  
  /**
   * æ˜¾ç¤ºåŠ è½½çŠ¶æ€
   * @private
   */
  _showLoading(key = 'global') {
    // å®ç°åŠ è½½çŠ¶æ€æ˜¾ç¤ºé€»è¾‘
    console.log(`[Fetch] æ˜¾ç¤ºåŠ è½½çŠ¶æ€: ${key}`)
  }
  
  /**
   * éšè—åŠ è½½çŠ¶æ€
   * @private
   */
  _hideLoading(key = 'global') {
    // å®ç°åŠ è½½çŠ¶æ€éšè—é€»è¾‘
    console.log(`[Fetch] éšè—åŠ è½½çŠ¶æ€: ${key}`)
  }
  
  /**
   * å¤„ç†å“åº”
   * @private
   */
  async _handleResponse(response, config) {
    // æ£€æŸ¥HTTPçŠ¶æ€
    if (!response.ok) {
      const error = new Error(`HTTPé”™è¯¯: ${response.status}`)
      error.status = response.status
      error.response = response
      
      // å°è¯•è§£æé”™è¯¯å“åº”
      try {
        error.data = await response.json()
      } catch (e) {
        // å¿½ç•¥è§£æé”™è¯¯
      }
      
      throw error
    }
    
    // æ£€æŸ¥å“åº”ç±»å‹å¹¶è§£æ
    const contentType = response.headers.get('content-type')
    
    if (contentType && contentType.includes('application/json')) {
      const data = await response.json()
      
      // å¤„ç†è‡ªå®šä¹‰å“åº”æ ¼å¼
      if (data.code !== undefined) {
        if (data.code === 0) {
          return data.data
        } else {
          const error = new Error(data.message || 'è¯·æ±‚å¤±è´¥')
          error.code = data.code
          error.data = data.data
          
          if (config.showError) {
            // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
            console.error(`[Fetch] ä¸šåŠ¡é”™è¯¯: ${error.message}`)
          }
          
          throw error
        }
      }
      
      return data
    } else if (contentType && contentType.includes('text/')) {
      return response.text()
    } else {
      return response.blob()
    }
  }
  
  /**
   * å¤„ç†é”™è¯¯
   * @private
   */
  _handleError(error, config) {
    // å¤„ç†è¶…æ—¶é”™è¯¯
    if (error.name === 'AbortError') {
      error.message = 'è¯·æ±‚è¶…æ—¶'
    }
    
    // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
    if (config.showError) {
      console.error(`[Fetch] è¯·æ±‚é”™è¯¯: ${error.message}`)
    }
    
    throw error
  }
  
  /**
   * GETè¯·æ±‚
   */
  get(url, options = {}) {
    return this.request(url, {
      method: 'GET',
      ...options
    })
  }
  
  /**
   * POSTè¯·æ±‚
   */
  post(url, data, options = {}) {
    return this.request(url, {
      method: 'POST',
      body: data,
      ...options
    })
  }
  
  /**
   * PUTè¯·æ±‚
   */
  put(url, data, options = {}) {
    return this.request(url, {
      method: 'PUT',
      body: data,
      ...options
    })
  }
  
  /**
   * DELETEè¯·æ±‚
   */
  delete(url, options = {}) {
    return this.request(url, {
      method: 'DELETE',
      ...options
    })
  }
  
  /**
   * PATCHè¯·æ±‚
   */
  patch(url, data, options = {}) {
    return this.request(url, {
      method: 'PATCH',
      body: data,
      ...options
    })
  }
}

// åˆ›å»ºå®ä¾‹
const fetchRequest = new FetchRequest(import.meta.env.VITE_API_BASE_URL || '/api')

export default fetchRequest
```

### ä¸Axiosçš„å¯¹æ¯”

Fetch APIå’ŒAxioså„æœ‰ä¼˜ç¼ºç‚¹ï¼Œä¸‹é¢æ˜¯å®ƒä»¬çš„è¯¦ç»†å¯¹æ¯”ï¼š

| ç‰¹æ€§ | Fetch API | Axios |
|------|-----------|-------|
| **æµè§ˆå™¨æ”¯æŒ** | ç°ä»£æµè§ˆå™¨åŸç”Ÿæ”¯æŒï¼Œæ—§æµè§ˆå™¨éœ€è¦polyfill | æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒï¼ˆåŸºäºXMLHttpRequestï¼‰ |
| **è¯·æ±‚å–æ¶ˆ** | æ”¯æŒï¼ˆä½¿ç”¨AbortControllerï¼‰ | æ”¯æŒï¼ˆä½¿ç”¨CancelTokenæˆ–AbortControllerï¼‰ |
| **è¯·æ±‚è¶…æ—¶** | éœ€è¦æ‰‹åŠ¨å®ç° | å†…ç½®æ”¯æŒ |
| **è‡ªåŠ¨è½¬æ¢JSON** | éœ€è¦æ‰‹åŠ¨è°ƒç”¨response.json() | è‡ªåŠ¨è½¬æ¢ |
| **æ‹¦æˆªå™¨** | éœ€è¦æ‰‹åŠ¨å®ç° | å†…ç½®æ”¯æŒ |
| **ä¸‹è½½è¿›åº¦** | æ”¯æŒï¼ˆä½¿ç”¨Response.bodyï¼‰ | æ”¯æŒ |
| **ä¸Šä¼ è¿›åº¦** | ä¸æ”¯æŒ | æ”¯æŒ |
| **CSRFä¿æŠ¤** | éœ€è¦æ‰‹åŠ¨å®ç° | å†…ç½®æ”¯æŒ |
| **å¹¶å‘è¯·æ±‚** | ä½¿ç”¨Promise.all | ä½¿ç”¨axios.all |
| **é”™è¯¯å¤„ç†** | HTTPé”™è¯¯ä¸ä¼šreject Promise | HTTPé”™è¯¯ä¼šreject Promise |
| **ä½“ç§¯** | æµè§ˆå™¨åŸç”ŸAPIï¼Œæ— é¢å¤–ä½“ç§¯ | çº¦15KBï¼ˆmin+gzipï¼‰ |
| **Node.jsæ”¯æŒ** | éœ€è¦ä½¿ç”¨node-fetchç­‰åº“ | åŸç”Ÿæ”¯æŒ |

#### ä½•æ—¶é€‰æ‹©Fetch API

- å½“é¡¹ç›®éœ€è¦å‡å°‘ä¾èµ–å’ŒåŒ…ä½“ç§¯æ—¶
- å½“åªéœ€è¦åŸºæœ¬çš„HTTPè¯·æ±‚åŠŸèƒ½æ—¶
- å½“ç›®æ ‡æµè§ˆå™¨éƒ½æ˜¯ç°ä»£æµè§ˆå™¨æ—¶
- å½“å¸Œæœ›ä½¿ç”¨æµè§ˆå™¨åŸç”ŸAPIæ—¶

#### ä½•æ—¶é€‰æ‹©Axios

- å½“éœ€è¦æ›´ä¸°å¯Œçš„åŠŸèƒ½å’Œæ›´å¥½çš„å¼€ç®±å³ç”¨ä½“éªŒæ—¶
- å½“éœ€è¦æ”¯æŒæ—§æµè§ˆå™¨æ—¶
- å½“éœ€è¦åœ¨Node.jså’Œæµè§ˆå™¨ä¸­ä½¿ç”¨ç›¸åŒçš„APIæ—¶
- å½“é¡¹ç›®å·²ç»ä½¿ç”¨äº†å…¶ä»–ä¾èµ–ï¼Œé¢å¤–çš„15KBä¸æ˜¯é—®é¢˜æ—¶

### ç»„åˆå¼APIå°è£…

ä½¿ç”¨Vue 3çš„ç»„åˆå¼APIï¼Œå¯ä»¥åˆ›å»ºå¯å¤ç”¨çš„ç½‘ç»œè¯·æ±‚é’©å­ï¼Œä½¿ç½‘ç»œè¯·æ±‚é€»è¾‘æ›´åŠ æ¨¡å—åŒ–å’Œå¯æµ‹è¯•ã€‚

#### åŸºç¡€è¯·æ±‚é’©å­

```javascript
// src/composables/useRequest.js
import { ref, unref, isRef } from 
è®©æˆ‘ç»§ç»­å®Œæˆå…³äºç»„åˆå¼APIå°è£…çš„å†…å®¹ï¼š

#### åŸºç¡€è¯·æ±‚é’©å­

```javascript
// src/composables/useRequest.js
import { ref, unref, isRef } from 'vue'
import { useLoadingStore } from '@/stores/loading'

/**
 * é€šç”¨è¯·æ±‚é’©å­
 * @param {Function} requestFn - è¯·æ±‚å‡½æ•°
 * @param {Object} options - é…ç½®é€‰é¡¹
 * @returns {Object} è¯·æ±‚çŠ¶æ€å’Œæ–¹æ³•
 */
export function useRequest(requestFn, options = {}) {
  // é»˜è®¤é€‰é¡¹
  const defaultOptions = {
    immediate: false,      // æ˜¯å¦ç«‹å³æ‰§è¡Œ
    initialData: null,     // åˆå§‹æ•°æ®
    resetOnExecute: true,  // æ‰§è¡Œæ—¶æ˜¯å¦é‡ç½®æ•°æ®
    onSuccess: null,       // æˆåŠŸå›è°ƒ
    onError: null,         // é”™è¯¯å›è°ƒ
    onFinally: null,       // å®Œæˆå›è°ƒ
    loadingKey: 'default', // åŠ è½½çŠ¶æ€key
    formatResult: data => data, // ç»“æœæ ¼å¼åŒ–å‡½æ•°
  }
  
  // åˆå¹¶é€‰é¡¹
  const mergedOptions = { ...defaultOptions, ...options }
  
  // çŠ¶æ€
  const data = ref(mergedOptions.initialData)
  const loading = ref(false)
  const error = ref(null)
  const loadingStore = useLoadingStore()
  
  // æ‰§è¡Œè¯·æ±‚
  const execute = async (...args) => {
    // é‡ç½®çŠ¶æ€
    if (mergedOptions.resetOnExecute) {
      data.value = mergedOptions.initialData
      error.value = null
    }
    
    loading.value = true
    loadingStore.addLoading(mergedOptions.loadingKey)
    
    try {
      // æ‰§è¡Œè¯·æ±‚å‡½æ•°
      const rawResult = await requestFn(...args)
      
      // æ ¼å¼åŒ–ç»“æœ
      const formattedResult = mergedOptions.formatResult(rawResult)
      
      // æ›´æ–°æ•°æ®
      data.value = formattedResult
      
      // è°ƒç”¨æˆåŠŸå›è°ƒ
      if (mergedOptions.onSuccess) {
        mergedOptions.onSuccess(formattedResult, ...args)
      }
      
      return formattedResult
    } catch (err) {
      // æ›´æ–°é”™è¯¯
      error.value = err
      
      // è°ƒç”¨é”™è¯¯å›è°ƒ
      if (mergedOptions.onError) {
        mergedOptions.onError(err, ...args)
      }
      
      throw err
    } finally {
      // æ›´æ–°åŠ è½½çŠ¶æ€
      loading.value = false
      loadingStore.removeLoading(mergedOptions.loadingKey)
      
      // è°ƒç”¨å®Œæˆå›è°ƒ
      if (mergedOptions.onFinally) {
        mergedOptions.onFinally(...args)
      }
    }
  }
  
  // å¦‚æœéœ€è¦ç«‹å³æ‰§è¡Œ
  if (mergedOptions.immediate) {
    execute()
  }
  
  return {
    data,
    loading,
    error,
    execute,
    // é‡ç½®æ•°æ®
    reset: () => {
      data.value = mergedOptions.initialData
      error.value = null
    }
  }
}
```

#### ç‰¹å®šè¯·æ±‚ç±»å‹çš„é’©å­

åŸºäºåŸºç¡€é’©å­ï¼Œå¯ä»¥åˆ›å»ºç‰¹å®šç±»å‹è¯·æ±‚çš„é’©å­ï¼š

```javascript
// src/composables/useGet.js
import { useRequest } from './useRequest'
import request from '@/utils/request'

/**
 * GETè¯·æ±‚é’©å­
 * @param {string|Ref<string>} url - è¯·æ±‚URL
 * @param {Object|Ref<Object>} params - è¯·æ±‚å‚æ•°
 * @param {Object} options - é…ç½®é€‰é¡¹
 * @returns {Object} è¯·æ±‚çŠ¶æ€å’Œæ–¹æ³•
 */
export function useGet(url, params = {}, options = {}) {
  // åˆ›å»ºè¯·æ±‚å‡½æ•°
  const requestFn = async () => {
    // è§£åŒ…å¯èƒ½çš„ref
    const resolvedUrl = unref(url)
    const resolvedParams = unref(params)
    
    return request.get(resolvedUrl, { params: resolvedParams })
  }
  
  return useRequest(requestFn, options)
}

// src/composables/usePost.js
import { useRequest } from './useRequest'
import request from '@/utils/request'

/**
 * POSTè¯·æ±‚é’©å­
 * @param {string|Ref<string>} url - è¯·æ±‚URL
 * @param {Object|Ref<Object>} data - è¯·æ±‚æ•°æ®
 * @param {Object} options - é…ç½®é€‰é¡¹
 * @returns {Object} è¯·æ±‚çŠ¶æ€å’Œæ–¹æ³•
 */
export function usePost(url, data = {}, options = {}) {
  // åˆ›å»ºè¯·æ±‚å‡½æ•°
  const requestFn = async (payload) => {
    // è§£åŒ…å¯èƒ½çš„ref
    const resolvedUrl = unref(url)
    const resolvedData = payload || unref(data)
    
    return request.post(resolvedUrl, resolvedData)
  }
  
  return useRequest(requestFn, options)
}
```

#### åˆ†é¡µè¯·æ±‚é’©å­

å¤„ç†åˆ†é¡µæ•°æ®æ˜¯å¸¸è§éœ€æ±‚ï¼Œå¯ä»¥åˆ›å»ºä¸“é—¨çš„åˆ†é¡µè¯·æ±‚é’©å­ï¼š

```javascript
// src/composables/usePagination.js
import { ref, computed, watch } from 'vue'
import { useRequest } from './useRequest'

/**
 * åˆ†é¡µè¯·æ±‚é’©å­
 * @param {Function} requestFn - è¯·æ±‚å‡½æ•°ï¼Œæ¥æ”¶(page, pageSize, ...args)å‚æ•°
 * @param {Object} options - é…ç½®é€‰é¡¹
 * @returns {Object} åˆ†é¡µçŠ¶æ€å’Œæ–¹æ³•
 */
export function usePagination(requestFn, options = {}) {
  // é»˜è®¤é€‰é¡¹
  const defaultOptions = {
    immediate: false,
    initialPage: 1,
    initialPageSize: 10,
    initialTotal: 0,
    initialData: [],
    formatResult: (res) => ({
      list: res.list || res.data || [],
      total: res.total || 0
    })
  }
  
  // åˆå¹¶é€‰é¡¹
  const mergedOptions = { ...defaultOptions, ...options }
  
  // åˆ†é¡µçŠ¶æ€
  const currentPage = ref(mergedOptions.initialPage)
  const pageSize = ref(mergedOptions.initialPageSize)
  const total = ref(mergedOptions.initialTotal)
  
  // åˆ›å»ºè¯·æ±‚å‡½æ•°
  const fetchData = async (...args) => {
    return requestFn(currentPage.value, pageSize.value, ...args)
  }
  
  // ä½¿ç”¨åŸºç¡€è¯·æ±‚é’©å­
  const { data, loading, error, execute } = useRequest(fetchData, {
    ...mergedOptions,
    formatResult: (res) => {
      const formatted = mergedOptions.formatResult(res)
      total.value = formatted.total
      return formatted.list
    }
  })
  
  // è®¡ç®—å±æ€§
  const pageCount = computed(() => {
    return Math.ceil(total.value / pageSize.value)
  })
  
  // æ˜¯å¦æœ‰ä¸Šä¸€é¡µ
  const hasPrevious = computed(() => {
    return currentPage.value > 1
  })
  
  // æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ
  const hasNext = computed(() => {
    return currentPage.value < pageCount.value
  })
  
  // åˆ‡æ¢é¡µç 
  const changePage = (page) => {
    if (page === currentPage.value) return
    
    currentPage.value = page
    return execute()
  }
  
  // åˆ‡æ¢æ¯é¡µæ¡æ•°
  const changePageSize = (size) => {
    if (size === pageSize.value) return
    
    pageSize.value = size
    // åˆ‡æ¢æ¯é¡µæ¡æ•°æ—¶ï¼Œé€šå¸¸å›åˆ°ç¬¬ä¸€é¡µ
    currentPage.value = 1
    return execute()
  }
  
  // åˆ·æ–°å½“å‰é¡µ
  const refresh = () => {
    return execute()
  }
  
  // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
  const reset = () => {
    currentPage.value = mergedOptions.initialPage
    pageSize.value = mergedOptions.initialPageSize
    return execute()
  }
  
  // ç›‘å¬åˆ†é¡µå‚æ•°å˜åŒ–
  if (mergedOptions.immediate) {
    execute()
  }
  
  return {
    // æ•°æ®å’ŒçŠ¶æ€
    data,
    loading,
    error,
    total,
    currentPage,
    pageSize,
    pageCount,
    hasPrevious,
    hasNext,
    
    // æ–¹æ³•
    execute,
    changePage,
    changePageSize,
    refresh,
    reset
  }
}
```

#### åœ¨ç»„ä»¶ä¸­ä½¿ç”¨

```vue
<script setup>
import { useGet } from '@/composables/useGet'
import { usePagination } from '@/composables/usePagination'
import { userApi } from '@/api/user'

// åŸºç¡€GETè¯·æ±‚
const { 
  data: user, 
  loading: userLoading, 
  error: userError,
  execute: fetchUser
} = useGet('/users/1', null, { immediate: true })

// å¸¦å‚æ•°çš„GETè¯·æ±‚
const userId = ref(1)
const { 
  data: userDetail, 
  loading: detailLoading,
  execute: fetchUserDetail
} = useGet(
  () => `/users/${userId.value}`,
  null,
  { 
    immediate: true,
    onSuccess: (data) => {
      console.log('ç”¨æˆ·è¯¦æƒ…è·å–æˆåŠŸ:', data)
    }
  }
)

// å½“userIdå˜åŒ–æ—¶é‡æ–°è·å–æ•°æ®
watch(userId, () => {
  fetchUserDetail()
})

// ä½¿ç”¨APIæœåŠ¡çš„åˆ†é¡µè¯·æ±‚
const { 
  data: userList,
  loading: listLoading,
  total,
  currentPage,
  pageSize,
  changePage,
  changePageSize
} = usePagination(
  (page, pageSize) => userApi.getUsers({ page, pageSize }),
  { 
    immediate: true,
    initialPageSize: 20
  }
)
</script>

<template>
  <div>
    <!-- ç”¨æˆ·è¯¦æƒ… -->
    <div v-if="detailLoading">åŠ è½½ç”¨æˆ·è¯¦æƒ…ä¸­...</div>
    <div v-else-if="userDetail">
      <h2>{{ userDetail.name }}</h2>
      <p>{{ userDetail.email }}</p>
    </div>
    
    <!-- ç”¨æˆ·åˆ—è¡¨ -->
    <div>
      <h3>ç”¨æˆ·åˆ—è¡¨ (æ€»è®¡: {{ total }})</h3>
      <div v-if="listLoading">åŠ è½½ç”¨æˆ·åˆ—è¡¨ä¸­...</div>
      <ul v-else>
        <li v-for="user in userList" :key="user.id">
          {{ user.name }} - {{ user.email }}
        </li>
      </ul>
      
      <!-- åˆ†é¡µæ§ä»¶ -->
      <div class="pagination">
        <button 
          :disabled="currentPage <= 1" 
          @click="changePage(currentPage - 1)"
        >
          ä¸Šä¸€é¡µ
        </button>
        <span>{{ currentPage }} / {{ Math.ceil(total / pageSize) }}</span>
        <button 
          :disabled="currentPage >= Math.ceil(total / pageSize)" 
          @click="changePage(currentPage + 1)"
        >
          ä¸‹ä¸€é¡µ
        </button>
        
        <select v-model="pageSize" @change="changePageSize(pageSize)">
          <option :value="10">10æ¡/é¡µ</option>
          <option :value="20">20æ¡/é¡µ</option>
          <option :value="50">50æ¡/é¡µ</option>
        </select>
      </div>
    </div>
  </div>
</template>
```

## GraphQLå®¢æˆ·ç«¯

GraphQLæ˜¯ä¸€ç§ç”¨äºAPIçš„æŸ¥è¯¢è¯­è¨€ï¼Œå®ƒå…è®¸å®¢æˆ·ç«¯ç²¾ç¡®åœ°æŒ‡å®šæ‰€éœ€çš„æ•°æ®ï¼Œé¿å…äº†ä¼ ç»ŸREST APIä¸­çš„è¿‡åº¦è·å–å’Œæ¬ è·å–é—®é¢˜ã€‚åœ¨Vueåº”ç”¨ä¸­ï¼Œæœ‰å‡ ç§æµè¡Œçš„GraphQLå®¢æˆ·ç«¯å¯ä¾›é€‰æ‹©ã€‚

### Apollo Client

Apollo Clientæ˜¯æœ€æµè¡Œçš„GraphQLå®¢æˆ·ç«¯ä¹‹ä¸€ï¼Œå®ƒæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½å’Œè‰¯å¥½çš„Vueé›†æˆã€‚

#### å®‰è£…ä¸é…ç½®

é¦–å…ˆï¼Œå®‰è£…æ‰€éœ€çš„ä¾èµ–ï¼š

```bash
npm install @apollo/client graphql @vue/apollo-composable
```

ç„¶åï¼Œåˆ›å»ºApollo Clientå®ä¾‹ï¼š

```javascript
// src/apollo/index.js
import { ApolloClient, InMemoryCache, createHttpLink, from } from '@apollo/client/core'
import { onError } from '@apollo/client/link/error'
import { setContext } from '@apollo/client/link/context'
import { useAuthStore } from '@/stores/auth'

// åˆ›å»ºHTTPé“¾æ¥
const httpLink = createHttpLink({
  uri: import.meta.env.VITE_GRAPHQL_URL || '/graphql'
})

// é”™è¯¯å¤„ç†é“¾æ¥
const errorLink = onError(({ graphQLErrors, networkError }) => {
  if (graphQLErrors) {
    graphQLErrors.forEach(({ message, locations, path }) => {
      console.error(
        `[GraphQL error]: Message: ${message}, Location: ${locations}, Path: ${path}`
      )
    })
  }
  
  if (networkError) {
    console.error(`[Network error]: ${networkError}`)
  }
})

// è®¤è¯é“¾æ¥
const authLink = setContext((_, { headers }) => {
  // è·å–è®¤è¯çŠ¶æ€
  const authStore = useAuthStore()
  
  // è¿”å›å¸¦æœ‰è®¤è¯å¤´çš„ä¸Šä¸‹æ–‡
  return {
    headers: {
      ...headers,
      authorization: authStore.token ? `Bearer ${authStore.token}` : ''
    }
  }
})

// åˆ›å»ºç¼“å­˜
const cache = new InMemoryCache({
  typePolicies: {
    // å®šä¹‰ç±»å‹ç­–ç•¥
    Query: {
      fields: {
        // ç¤ºä¾‹ï¼šåˆå¹¶åˆ†é¡µæ•°æ®
        users: {
          keyArgs: ['filter'], // ç”¨äºç¼“å­˜é”®çš„å‚æ•°
          merge(existing = { items: [] }, incoming) {
            return {
              ...incoming,
              items: [...existing.items, ...incoming.items]
            }
          }
        }
      }
    }
  }
})

// åˆ›å»ºApolloå®¢æˆ·ç«¯
export const apolloClient = new ApolloClient({
  link: from([errorLink, authLink, httpLink]),
  cache,
  defaultOptions: {
    watchQuery: {
      fetchPolicy: 'cache-and-network',
      errorPolicy: 'all'
    },
    query: {
      fetchPolicy: 'network-only',
      errorPolicy: 'all'
    },
    mutate: {
      errorPolicy: 'all'
    }
  }
})
```

åœ¨Vueåº”ç”¨ä¸­æä¾›Apolloå®¢æˆ·ç«¯ï¼š

```javascript
// src/main.js
import { createApp, provide, h } from 'vue'
import { DefaultApolloClient } from '@vue/apollo-composable'
import { apolloClient } from './apollo'
import App from './App.vue'

const app = createApp({
  setup() {
    provide(DefaultApolloClient, apolloClient)
    return () => h(App)
  }
})

app.mount('#app')
```

#### åŸºç¡€æŸ¥è¯¢ä¸å˜æ›´

ä½¿ç”¨Apollo Composable APIè¿›è¡ŒæŸ¥è¯¢å’Œå˜æ›´ï¼š

```vue
<script setup>
import { useQuery, useMutation } from '@vue/apollo-composable'
import { gql } from '@apollo/client/core'

// å®šä¹‰æŸ¥è¯¢
const GET_USERS = gql`
  query GetUsers($page: Int!, $pageSize: Int!) {
    users(page: $page, pageSize: $pageSize) {
      items {
        id
        name
        email
      }
      total
      page
      pageSize
    }
  }
`

// å®šä¹‰å˜æ›´
const CREATE_USER = gql`
  mutation CreateUser($input: CreateUserInput!) {
    createUser(input: $input) {
      id
      name
      email
    }
  }
`

// æŸ¥è¯¢å‚æ•°
const variables = ref({
  page: 1,
  pageSize: 10
})

// æ‰§è¡ŒæŸ¥è¯¢
const { result, loading, error, refetch } = useQuery(
  GET_USERS,
  variables,
  {
    // æŸ¥è¯¢é€‰é¡¹
    fetchPolicy: 'cache-and-network',
    notifyOnNetworkStatusChange: true
  }
)

// è®¡ç®—å±æ€§ï¼šç”¨æˆ·åˆ—è¡¨
const users = computed(() => result.value?.users.items || [])
const total = computed(() => result.value?.users.total || 0)

// æ‰§è¡Œå˜æ›´
const { mutate: createUser, loading: creating } = useMutation(CREATE_USER)

// åˆ›å»ºç”¨æˆ·æ–¹æ³•
const handleCreateUser = async (userData) => {
  try {
    const { data } = await createUser({
      input: userData
    })
    
    console.log('ç”¨æˆ·åˆ›å»ºæˆåŠŸ:', data.createUser)
    
    // åˆ·æ–°æŸ¥è¯¢
    refetch()
    
    return data.createUser
  } catch (error) {
    console.error('åˆ›å»ºç”¨æˆ·å¤±è´¥:', error)
    throw error
  }
}

// åˆ‡æ¢é¡µç 
const changePage = (page) => {
  variables.value.page = page
}
</script>

<template>
  <div>
    <h2>ç”¨æˆ·åˆ—è¡¨</h2>
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <div v-if="loading && !result">åŠ è½½ä¸­...</div>
    
    <!-- é”™è¯¯çŠ¶æ€ -->
    <div v-else-if="error">
      åŠ è½½å¤±è´¥: {{ error.message }}
      <button @click="refetch">é‡è¯•</button>
    </div>
    
    <!-- æ•°æ®å±•ç¤º -->
    <div v-else>
      <ul>
        <li v-for="user in users" :key="user.id">
          {{ user.name }} ({{ user.email }})
        </li>
      </ul>
      
      <!-- åˆ†é¡µæ§ä»¶ -->
      <div class="pagination">
        <button 
          :disabled="variables.page <= 1" 
          @click="changePage(variables.page - 1)"
        >
          ä¸Šä¸€é¡µ
        </button>
        <span>{{ variables.page }} / {{ Math.ceil(total / variables.pageSize) }}</span>
        <button 
          :disabled="variables.page >= Math.ceil(total / variables.pageSize)" 
          @click="changePage(variables.page + 1)"
        >
          ä¸‹ä¸€é¡µ
        </button>
      </div>
    </div>
    
    <!-- åˆ›å»ºç”¨æˆ·è¡¨å• -->
    <div>
      <h3>åˆ›å»ºç”¨æˆ·</h3>
      <form @submit.prevent="handleCreateUser(formData)">
        <!-- è¡¨å•å†…å®¹ -->
      </form>
    </div>
  </div>
</template>
```

#### ç¼“å­˜ç®¡ç†

Apollo Clientçš„ä¸€ä¸ªå¼ºå¤§ç‰¹æ€§æ˜¯å…¶ç¼“å­˜ç³»ç»Ÿï¼Œå®ƒå¯ä»¥è‡ªåŠ¨åˆå¹¶å’Œæ›´æ–°æ•°æ®ï¼š

```javascript
// æ›´æ–°ç¼“å­˜ä¸­çš„æ•°æ®
const updateCache = (cache, { data }) => {
  // è¯»å–ç¼“å­˜
  const existingUsers = cache.readQuery({
    query: GET_USERS,
    variables: { page: 1, pageSize: 10 }
  })
  
  // æ›´æ–°ç¼“å­˜
  cache.writeQuery({
    query: GET_USERS,
    variables: { page: 1, pageSize: 10 },
    data: {
      users: {
        ...existingUsers.users,
        items: [data.createUser, ...existingUsers.users.items],
        total: existingUsers.users.total + 1
      }
    }
  })
}

// åœ¨å˜æ›´ä¸­ä½¿ç”¨
const { mutate: createUser } = useMutation(CREATE_USER, {
  update: updateCache
})
```

#### è®¢é˜…

GraphQLè¿˜æ”¯æŒå®æ—¶è®¢é˜…ï¼ŒApollo Clientå¯ä»¥é€šè¿‡WebSocketå¤„ç†è®¢é˜…ï¼š

```javascript
// å®‰è£…ä¾èµ–
// npm install @apollo/client subscriptions-transport-ws

// é…ç½®WebSocketé“¾æ¥
import { WebSocketLink } from '@apollo/client/link/ws'
import { split } from '@apollo/client/core'
import { getMainDefinition } from '@apollo/client/utilities'

// åˆ›å»ºWebSocketé“¾æ¥
const wsLink = new WebSocketLink({
  uri: import.meta.env.VITE_GRAPHQL_WS_URL || 'ws://localhost:4000/graphql',
  options: {
    reconnect: true,
    connectionParams: () => {
      const authStore = useAuthStore()
      return {
        authorization: authStore.token ? `Bearer ${authStore.token}` : ''
      }
    }
  }
})

// æ ¹æ®æ“ä½œç±»å‹åˆ†å‰²é“¾æ¥
const splitLink = split(
  ({ query }) => {
    const definition = getMainDefinition(query)
    return (
      definition.kind === 'OperationDefinition' &&
      definition.operation === 'subscription'
    )
  },
  wsLink,
  from([errorLink, authLink, httpLink])
)

// æ›´æ–°Apolloå®¢æˆ·ç«¯
export const apolloClient = new ApolloClient({
  link: splitLink,
  cache
})
```

åœ¨ç»„ä»¶ä¸­ä½¿ç”¨è®¢é˜…ï¼š

```vue
<script setup>
import { useSubscription } from '@vue/apollo-composable'
import { gql } from '@apollo/client/core'

// å®šä¹‰è®¢é˜…
const USER_CREATED = gql`
  subscription OnUserCreated {
    userCreated {
      id
      name
      email
    }
  }
`

// æ‰§è¡Œè®¢é˜…
const { result } = useSubscription(USER_CREATED)

// ç›‘å¬æ–°ç”¨æˆ·åˆ›å»º
watch(
  () => result.value?.userCreated,
  newUser => {
    if (newUser) {
      console.log('æ–°ç”¨æˆ·åˆ›å»º:', newUser)
      // æ›´æ–°æœ¬åœ°çŠ¶æ€æˆ–æ˜¾ç¤ºé€šçŸ¥
    }
  }
)
</script>
```

### urql

urqlæ˜¯ä¸€ä¸ªè½»é‡çº§çš„GraphQLå®¢æˆ·ç«¯ï¼Œç›¸æ¯”Apollo Clientæ›´ç®€å•ï¼Œä½†ä»æä¾›äº†å¼ºå¤§çš„åŠŸèƒ½ã€‚

#### å®‰è£…ä¸é…ç½®

```bash
npm install @urql/vue graphql
```

åˆ›å»ºurqlå®¢æˆ·ç«¯ï¼š

```javascript
// src/urql/index.js
import { createClient, dedupExchange, cacheExchange, fetchExchange, errorExchange } from '@urql/vue'
import { useAuthStore } from '@/stores/auth'

// åˆ›å»ºurqlå®¢æˆ·ç«¯
export const urqlClient = createClient({
  url: import.meta.env.VITE_GRAPHQL_URL || '/graphql',
  
  // é…ç½®äº¤æ¢å™¨
  exchanges: [
    dedupExchange,
    cacheExchange,
    errorExchange({
      onError: (error) => {
        const { graphQLErrors, networkError } = error
        
        if (graphQLErrors) {
          graphQLErrors.forEach(({ message, locations, path }) => {
            console.error(
              `[GraphQL error]: Message: ${message}, Location: ${locations}, Path: ${path}`
            )
          })
        }
        
        if (networkError) {
          console.error(`[Network error]: ${networkError}`)
        }
      }
    }),
    fetchExchange
  ],
  
  // è¯·æ±‚é…ç½®
  fetchOptions: () => {
    const authStore = useAuthStore()
    
    return {
      headers: {
        authorization: authStore.token ? `Bearer ${authStore.token}` : ''
      }
    }
  }
})
```

åœ¨Vueåº”ç”¨ä¸­æä¾›urqlå®¢æˆ·ç«¯ï¼š

```javascript
// src/main.js
import { createApp } from 'vue'
import { createClient, provideClient } from '@urql/vue'
import { urqlClient } from './urql'
import App from './App.vue'

const app = createApp(App)

// æä¾›urqlå®¢æˆ·ç«¯
app.use(urqlClient)

app.mount('#app')
```

#### åŸºç¡€æŸ¥è¯¢ä¸å˜æ›´

ä½¿ç”¨urqlçš„ç»„åˆå¼APIè¿›è¡ŒæŸ¥è¯¢å’Œå˜æ›´ï¼š

```vue
<script setup>
import { useQuery, useMutation } from '@urql/vue'
import { ref, computed } from 'vue'

// å®šä¹‰æŸ¥è¯¢
const GET_USERS = `
  query GetUsers($page: Int!, $pageSize: Int!) {
    users(page: $page, pageSize: $pageSize) {
      items {
        id
        name
        email
      }
      total
      page
      pageSize
    }
  }
`

// å®šä¹‰å˜æ›´
const CREATE_USER = `
  mutation CreateUser($input: CreateUserInput!) {
    createUser(input: $input) {
      id
      name
      email
    }
  }
`

// æŸ¥è¯¢å‚æ•°
const variables = ref({
  page: 1,
  pageSize: 10
})

// æ‰§è¡ŒæŸ¥è¯¢
const { data, fetching, error, executeQuery } = useQuery({
  query: GET_USERS,
  variables: variables
})

// è®¡ç®—å±æ€§ï¼šç”¨æˆ·åˆ—è¡¨
const users = computed(() => data.value?.users.items || [])
const total = computed(() => data.value?.users.total || 0)

// æ‰§è¡Œå˜æ›´
const { executeMutation } = useMutation(CREATE_USER)

// åˆ›å»ºç”¨æˆ·æ–¹æ³•
const handleCreateUser = async (userData) => {
  try {
    const result = await executeMutation({
      input: userData
    })
    
    if (result.error) {
      throw result.error
    }
    
    console.log('ç”¨æˆ·åˆ›å»ºæˆåŠŸ:', result.data.createUser)
    
    // åˆ·æ–°æŸ¥è¯¢
    executeQuery({ requestPolicy: 'network-only' })
    
    return result.data.createUser
  } catch (error) {
    console.error('åˆ›å»ºç”¨æˆ·å¤±è´¥:', error)
    throw error
  }
}

// åˆ‡æ¢é¡µç 
const changePage = (page) => {
  variables.value.page = page
}
</script>

<template>
  <div>
    <h2>ç”¨æˆ·åˆ—è¡¨</h2>
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <div v-if="fetching && !data">åŠ è½½ä¸­...</div>
    
    <!-- é”™è¯¯çŠ¶æ€ -->
    <div v-else-if="error">
      åŠ è½½å¤±è´¥: {{ error.message }}
      <button @click="executeQuery({ requestPolicy: 'network-only' })">é‡è¯•</button>
    </div>
    
    <!-- æ•°æ®å±•ç¤º -->
    <div v-else>
      <ul>
        <li v-for="user in users" :key="user.id">
          {{ user.name }} ({{ user.email }})
        </li>
      </ul>
      
      <!-- åˆ†é¡µæ§ä»¶ -->
      <div class="pagination">
        <button 
          :disabled="variables.page <= 1" 
          @click="changePage(variables.page - 1)"
        >
          ä¸Šä¸€é¡µ
        </button>
        <span>{{ variables.page }} / {{ Math.ceil(total / variables.pageSize) }}</span>
        <button 
          :disabled="variables.page >= Math.ceil(total / variables.pageSize)" 
          @click="changePage(variables.page + 1)"
        >
          ä¸‹ä¸€é¡µ
        </button>
      </div>
    </div>
  </div>
</template>
```

### ä¸REST APIçš„é›†æˆ

åœ¨è®¸å¤šé¡¹ç›®ä¸­ï¼Œéœ€è¦åŒæ—¶ä½¿ç”¨GraphQLå’ŒREST APIã€‚ä»¥ä¸‹æ˜¯å‡ ç§é›†æˆæ–¹å¼ï¼š

#### Apollo RESTæ•°æ®æº

Apollo Clientæä¾›äº†RESTæ•°æ®æºçš„æ”¯æŒï¼Œå¯ä»¥åœ¨GraphQLæœåŠ¡å™¨ä¸­åŒ…è£…REST APIï¼š

```javascript
// æœåŠ¡å™¨ç«¯ä»£ç 
const { RESTDataSource } = require('apollo-datasource-rest')

class UsersAPI extends RESTDataSource {
  constructor() {
    super()
    this.baseURL = 'https://api.example.com/'
  }
  
  async getUsers(page = 1, pageSize = 10) {
    return this.get(`users?page=${page}&pageSize=${pageSize}`)
  }
  
  async getUserById(id) {
    return this.get(`users/${id}`)
  }
  
  async createUser(userData) {
    return this.post('users', userData)
  }
}

// åœ¨Apollo Serverä¸­ä½¿ç”¨
const server = new ApolloServer({
  typeDefs,
  resolvers,
  dataSources: () => ({
    usersAPI: new UsersAPI()
  })
})
```

#### å®¢æˆ·ç«¯æ··åˆä½¿ç”¨

åœ¨å®¢æˆ·ç«¯åŒæ—¶ä½¿ç”¨GraphQLå’ŒREST APIï¼š

```vue
<script setup>
import { useQuery } from '@vue/apollo-composable'
import { gql } from '@apollo/client/core'
import { ref, onMounted } from 'vue'
import request from '@/utils/request'

// GraphQLæŸ¥è¯¢
const GET_PRODUCTS = gql`
  query GetProducts($page: Int!, $pageSize: Int!) {
    products(page: $page, pageSize: $pageSize) {
      items {
        id
        name
        price
      }
      total
    }
  }
`

// æŸ¥è¯¢å‚æ•°
const variables = ref({
  page: 1,
  pageSize: 10
})

// æ‰§è¡ŒGraphQLæŸ¥è¯¢
const { result: productsResult, loading: productsLoading } = useQuery(
  GET_PRODUCTS,
  variables
)

// è®¡ç®—å±æ€§ï¼šäº§å“åˆ—è¡¨
const products = computed(() => productsResult.value?.products.items || [])

// REST APIæ•°æ®
const users = ref([])
const usersLoading = ref(false)

// è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆREST APIï¼‰
const fetchUsers = async () => {
  usersLoading.value = true
  
  try {
    const response = await request.get('/users', {
      params: {
        page: variables.value.page,
        pageSize: variables.value.pageSize
      }
    })
    
    users.value = response.data
  } catch (error) {
    console.error('è·å–ç”¨æˆ·å¤±è´¥:', error)
  } finally {
    usersLoading.value = false
  }
}

// ç»„ä»¶æŒ‚è½½æ—¶è·å–ç”¨æˆ·æ•°æ®
onMounted(() => {
  fetchUsers()
})

// é¡µç å˜åŒ–æ—¶åŒæ—¶æ›´æ–°GraphQLå’ŒRESTæ•°æ®
const changePage = (page) => {
  variables.value.page = page
  fetchUsers()
}
</script>
```

#### GraphQLä»£ç†å±‚

åˆ›å»ºä¸€ä¸ªGraphQLä»£ç†å±‚ï¼Œç»Ÿä¸€å¤„ç†GraphQLå’ŒREST APIï¼š

```javascript
// æœåŠ¡å™¨ç«¯ä»£ç 
const { ApolloServer, gql } = require('apollo-server')
const { RESTDataSource } = require('apollo-datasource-rest')

// å®šä¹‰Schema
const typeDefs = gql`
  type User {
    id: ID!
    name: String!
    email: String!
  }
  
  type Product {
    id: ID!
    name: String!
    price: Float!
  }
  
  type Query {
    users(page: Int, pageSize: Int): [User]
    products(page: Int, pageSize:
è®©æˆ‘ç»§ç»­å®Œæˆå…³äºGraphQLä»£ç†å±‚çš„å†…å®¹ï¼š

#### GraphQLä»£ç†å±‚

åˆ›å»ºä¸€ä¸ªGraphQLä»£ç†å±‚ï¼Œç»Ÿä¸€å¤„ç†GraphQLå’ŒREST APIï¼š

```javascript
// æœåŠ¡å™¨ç«¯ä»£ç 
const { ApolloServer, gql } = require('apollo-server')
const { RESTDataSource } = require('apollo-datasource-rest')

// å®šä¹‰Schema
const typeDefs = gql`
  type User {
    id: ID!
    name: String!
    email: String!
  }
  
  type Product {
    id: ID!
    name: String!
    price: Float!
  }
  
  type Query {
    users(page: Int, pageSize: Int): [User]
    products(page: Int, pageSize: Int): [Product]
  }
`

// REST APIæ•°æ®æº
class UsersAPI extends RESTDataSource {
  constructor() {
    super()
    this.baseURL = 'https://api.example.com/users/'
  }
  
  async getUsers(page = 1, pageSize = 10) {
    return this.get(`?page=${page}&pageSize=${pageSize}`)
  }
}

class ProductsAPI extends RESTDataSource {
  constructor() {
    super()
    this.baseURL = 'https://api.example.com/products/'
  }
  
  async getProducts(page = 1, pageSize = 10) {
    return this.get(`?page=${page}&pageSize=${pageSize}`)
  }
}

// è§£æå™¨
const resolvers = {
  Query: {
    users: async (_, { page, pageSize }, { dataSources }) => {
      return dataSources.usersAPI.getUsers(page, pageSize)
    },
    products: async (_, { page, pageSize }, { dataSources }) => {
      return dataSources.productsAPI.getProducts(page, pageSize)
    }
  }
}

// åˆ›å»ºApolloæœåŠ¡å™¨
const server = new ApolloServer({
  typeDefs,
  resolvers,
  dataSources: () => ({
    usersAPI: new UsersAPI(),
    productsAPI: new ProductsAPI()
  })
})

// å¯åŠ¨æœåŠ¡å™¨
server.listen().then(({ url }) => {
  console.log(`ğŸš€ GraphQLä»£ç†æœåŠ¡å™¨è¿è¡Œåœ¨ ${url}`)
})
```

è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å®¢æˆ·ç«¯åªéœ€è¦ä½¿ç”¨GraphQL APIï¼Œè€Œä¸éœ€è¦å…³å¿ƒåº•å±‚æ•°æ®æ¥æºæ˜¯GraphQLè¿˜æ˜¯REST APIã€‚

#### ä½¿ç”¨GraphQL Code Generator

GraphQL Code Generatoræ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥æ ¹æ®GraphQL Schemaç”ŸæˆTypeScriptç±»å‹å’ŒAPIå®¢æˆ·ç«¯ä»£ç ï¼Œç®€åŒ–GraphQLçš„ä½¿ç”¨ï¼š

```bash
npm install -D @graphql-codegen/cli @graphql-codegen/typescript @graphql-codegen/typescript-operations @graphql-codegen/typescript-vue-apollo
```

åˆ›å»ºé…ç½®æ–‡ä»¶`codegen.yml`ï¼š

```yaml
schema: http://localhost:4000/graphql
documents: './src/**/*.graphql'
generates:
  src/generated/graphql.ts:
    plugins:
      - typescript
      - typescript-operations
      - typescript-vue-apollo
    config:
      withCompositionFunctions: true
      vueCompositionApiImportFrom: vue
```

åˆ›å»ºGraphQLæŸ¥è¯¢æ–‡ä»¶ï¼š

```graphql
# src/graphql/users.graphql
query GetUsers($page: Int!, $pageSize: Int!) {
  users(page: $page, pageSize: $pageSize) {
    items {
      id
      name
      email
    }
    total
    page
    pageSize
  }
}

mutation CreateUser($input: CreateUserInput!) {
  createUser(input: $input) {
    id
    name
    email
  }
}
```

è¿è¡Œä»£ç ç”Ÿæˆå™¨ï¼š

```bash
npx graphql-codegen
```

åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ç”Ÿæˆçš„ä»£ç ï¼š

```vue
<script setup>
import { ref } from 'vue'
import { useGetUsersQuery, useCreateUserMutation } from '@/generated/graphql'

// æŸ¥è¯¢å‚æ•°
const variables = ref({
  page: 1,
  pageSize: 10
})

// ä½¿ç”¨ç”Ÿæˆçš„æŸ¥è¯¢é’©å­
const { result, loading, error, refetch } = useGetUsersQuery(variables)

// ä½¿ç”¨ç”Ÿæˆçš„å˜æ›´é’©å­
const { mutate: createUser, loading: creating } = useCreateUserMutation()

// åˆ›å»ºç”¨æˆ·æ–¹æ³•
const handleCreateUser = async (userData) => {
  try {
    const { data } = await createUser({
      input: userData
    })
    
    console.log('ç”¨æˆ·åˆ›å»ºæˆåŠŸ:', data.createUser)
    
    // åˆ·æ–°æŸ¥è¯¢
    refetch()
    
    return data.createUser
  } catch (error) {
    console.error('åˆ›å»ºç”¨æˆ·å¤±è´¥:', error)
    throw error
  }
}
</script>
```

### è‡ªå®šä¹‰GraphQLå®¢æˆ·ç«¯

å¯¹äºä¸€äº›ç‰¹æ®Šéœ€æ±‚ï¼Œå¯èƒ½éœ€è¦åˆ›å»ºè‡ªå®šä¹‰çš„GraphQLå®¢æˆ·ç«¯ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºäºFetch APIçš„ç®€å•GraphQLå®¢æˆ·ç«¯ï¼š

```javascript
// src/utils/graphqlClient.js
import { useAuthStore } from '@/stores/auth'

/**
 * ç®€å•çš„GraphQLå®¢æˆ·ç«¯
 */
class GraphQLClient {
  constructor(url) {
    this.url = url
  }
  
  /**
   * æ‰§è¡ŒGraphQLæŸ¥è¯¢
   * @param {string} query - GraphQLæŸ¥è¯¢å­—ç¬¦ä¸²
   * @param {Object} variables - æŸ¥è¯¢å˜é‡
   * @param {Object} options - è¯·æ±‚é€‰é¡¹
   * @returns {Promise} å“åº”Promise
   */
  async query(query, variables = {}, options = {}) {
    return this.request(query, variables, options)
  }
  
  /**
   * æ‰§è¡ŒGraphQLå˜æ›´
   * @param {string} mutation - GraphQLå˜æ›´å­—ç¬¦ä¸²
   * @param {Object} variables - å˜æ›´å˜é‡
   * @param {Object} options - è¯·æ±‚é€‰é¡¹
   * @returns {Promise} å“åº”Promise
   */
  async mutate(mutation, variables = {}, options = {}) {
    return this.request(mutation, variables, options)
  }
  
  /**
   * å‘é€GraphQLè¯·æ±‚
   * @private
   */
  async request(query, variables = {}, options = {}) {
    const authStore = useAuthStore()
    
    // æ„å»ºè¯·æ±‚ä½“
    const body = JSON.stringify({
      query,
      variables
    })
    
    // æ„å»ºè¯·æ±‚é€‰é¡¹
    const fetchOptions = {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        ...options.headers
      },
      body
    }
    
    // æ·»åŠ è®¤è¯å¤´
    if (authStore.token) {
      fetchOptions.headers.Authorization = `Bearer ${authStore.token}`
    }
    
    try {
      // å‘é€è¯·æ±‚
      const response = await fetch(this.url, fetchOptions)
      
      // è§£æå“åº”
      const result = await response.json()
      
      // æ£€æŸ¥GraphQLé”™è¯¯
      if (result.errors) {
        const error = new Error('GraphQLé”™è¯¯')
        error.graphQLErrors = result.errors
        throw error
      }
      
      return result.data
    } catch (error) {
      console.error('GraphQLè¯·æ±‚å¤±è´¥:', error)
      throw error
    }
  }
}

// åˆ›å»ºå®¢æˆ·ç«¯å®ä¾‹
const graphqlClient = new GraphQLClient(
  import.meta.env.VITE_GRAPHQL_URL || '/graphql'
)

export default graphqlClient
```

åœ¨ç»„ä»¶ä¸­ä½¿ç”¨è‡ªå®šä¹‰å®¢æˆ·ç«¯ï¼š

```vue
<script setup>
import { ref, computed } from 'vue'
import graphqlClient from '@/utils/graphqlClient'

// æŸ¥è¯¢å‚æ•°
const variables = ref({
  page: 1,
  pageSize: 10
})

// æ•°æ®çŠ¶æ€
const users = ref([])
const loading = ref(false)
const error = ref(null)

// è·å–ç”¨æˆ·åˆ—è¡¨
const fetchUsers = async () => {
  loading.value = true
  error.value = null
  
  try {
    const query = `
      query GetUsers($page: Int!, $pageSize: Int!) {
        users(page: $page, pageSize: $pageSize) {
          items {
            id
            name
            email
          }
          total
          page
          pageSize
        }
      }
    `
    
    const data = await graphqlClient.query(query, variables.value)
    users.value = data.users.items
  } catch (err) {
    error.value = err.message || 'GraphQLæŸ¥è¯¢å¤±è´¥'
    console.error('è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥:', err)
  } finally {
    loading.value = false
  }
}

// åˆ›å»ºç”¨æˆ·
const createUser = async (userData) => {
  try {
    const mutation = `
      mutation CreateUser($input: CreateUserInput!) {
        createUser(input: $input) {
          id
          name
          email
        }
      }
    `
    
    const data = await graphqlClient.mutate(mutation, { input: userData })
    
    // æ·»åŠ åˆ°ç”¨æˆ·åˆ—è¡¨
    users.value.push(data.createUser)
    
    return data.createUser
  } catch (err) {
    console.error('åˆ›å»ºç”¨æˆ·å¤±è´¥:', err)
    throw err
  }
}

// åˆå§‹åŠ è½½
fetchUsers()
</script>
```

## æ€»ç»“

ç½‘ç»œè¯·æ±‚æ˜¯å‰ç«¯åº”ç”¨çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œé€‰æ‹©åˆé€‚çš„ç½‘ç»œè¯·æ±‚å·¥å…·å¯¹äºåº”ç”¨çš„æ€§èƒ½å’Œå¼€å‘æ•ˆç‡è‡³å…³é‡è¦ã€‚

### Axiosçš„ä¼˜åŠ¿

Axiosæ˜¯Vueé¡¹ç›®ä¸­æœ€å¸¸ç”¨çš„HTTPå®¢æˆ·ç«¯ï¼Œå®ƒæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½å’Œè‰¯å¥½çš„å¼€å‘ä½“éªŒï¼š
- æ‹¦æˆªå™¨ç³»ç»Ÿå…è®¸é›†ä¸­å¤„ç†è¯·æ±‚å’Œå“åº”
- è‡ªåŠ¨è½¬æ¢JSONæ•°æ®
- è¯·æ±‚å–æ¶ˆå’Œè¶…æ—¶æ§åˆ¶
- å¹¶å‘è¯·æ±‚å¤„ç†
- é”™è¯¯å¤„ç†å’Œè¯·æ±‚é‡è¯•
- å¹¿æ³›çš„æµè§ˆå™¨æ”¯æŒ

### Fetch APIçš„ä¼˜åŠ¿

Fetch APIæ˜¯ç°ä»£æµè§ˆå™¨æä¾›çš„åŸç”ŸAPIï¼Œå®ƒæ›´è½»é‡ä¸”ç¬¦åˆç°ä»£JavaScriptæ ‡å‡†ï¼š
- æµè§ˆå™¨åŸç”Ÿæ”¯æŒï¼Œæ— éœ€é¢å¤–ä¾èµ–
- åŸºäºPromiseï¼Œä¸ç°ä»£JavaScriptå¼‚æ­¥æ¨¡å¼ä¸€è‡´
- æ›´ç®€æ´çš„APIè®¾è®¡
- æ”¯æŒæµå¼å“åº”
- æ›´å¥½çš„CORSæ”¯æŒ

### GraphQLçš„ä¼˜åŠ¿

GraphQLæä¾›äº†ä¸€ç§æ›´çµæ´»çš„æ•°æ®è·å–æ–¹å¼ï¼š
- å®¢æˆ·ç«¯å¯ä»¥ç²¾ç¡®æŒ‡å®šæ‰€éœ€æ•°æ®ï¼Œé¿å…è¿‡åº¦è·å–
- å•ä¸€è¯·æ±‚è·å–å¤šä¸ªèµ„æºï¼Œå‡å°‘ç½‘ç»œå¾€è¿”
- å¼ºç±»å‹ç³»ç»Ÿï¼Œæä¾›æ›´å¥½çš„å¼€å‘ä½“éªŒå’Œå·¥å…·æ”¯æŒ
- å®æ—¶è®¢é˜…åŠŸèƒ½
- ç‰ˆæœ¬æ§åˆ¶æ›´ç®€å•

### æœ€ä½³å®è·µå»ºè®®

1. **é€‰æ‹©åˆé€‚çš„å·¥å…·**ï¼š
   - å¯¹äºå¤§å¤šæ•°Vueé¡¹ç›®ï¼ŒAxiosæ˜¯ä¸€ä¸ªå®‰å…¨çš„é€‰æ‹©
   - å¦‚æœé¡¹ç›®è¿½æ±‚è½»é‡åŒ–ï¼Œå¯ä»¥è€ƒè™‘å°è£…Fetch API
   - å¦‚æœåç«¯æä¾›GraphQL APIï¼Œæˆ–è€…éœ€è¦èšåˆå¤šä¸ªAPIï¼Œè€ƒè™‘ä½¿ç”¨GraphQLå®¢æˆ·ç«¯

2. **è¯·æ±‚å°è£…**ï¼š
   - åˆ›å»ºç»Ÿä¸€çš„è¯·æ±‚å®ä¾‹ï¼Œé…ç½®åŸºç¡€URLã€è¶…æ—¶ç­‰
   - å®ç°è¯·æ±‚æ‹¦æˆªå™¨å¤„ç†è®¤è¯ã€å‚æ•°è½¬æ¢ç­‰
   - å®ç°å“åº”æ‹¦æˆªå™¨å¤„ç†é”™è¯¯ã€æ•°æ®è½¬æ¢ç­‰
   - å°è£…APIæœåŠ¡å±‚ï¼Œéš”ç¦»ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®è·å–

3. **é”™è¯¯å¤„ç†**ï¼š
   - å®ç°å…¨å±€é”™è¯¯å¤„ç†æœºåˆ¶
   - åŒºåˆ†ç½‘ç»œé”™è¯¯å’Œä¸šåŠ¡é”™è¯¯
   - æä¾›å‹å¥½çš„é”™è¯¯æç¤º
   - å®ç°è¯·æ±‚é‡è¯•æœºåˆ¶

4. **çŠ¶æ€ç®¡ç†**ï¼š
   - ä½¿ç”¨åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨æå‡ç”¨æˆ·ä½“éªŒ
   - åˆç†ç¼“å­˜è¯·æ±‚ç»“æœ
   - è€ƒè™‘ä½¿ç”¨ç»„åˆå¼APIå°è£…è¯·æ±‚é€»è¾‘

5. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - å®ç°è¯·æ±‚å–æ¶ˆï¼Œé¿å…ä¸å¿…è¦çš„è¯·æ±‚
   - ä½¿ç”¨é˜²æŠ–å’ŒèŠ‚æµæ§åˆ¶è¯·æ±‚é¢‘ç‡
   - åˆç†è®¾ç½®ç¼“å­˜ç­–ç•¥
   - è€ƒè™‘ä½¿ç”¨é¢„å–å’Œæ‡’åŠ è½½

æ— è®ºé€‰æ‹©å“ªç§ç½‘ç»œè¯·æ±‚å·¥å…·ï¼Œå…³é”®æ˜¯å»ºç«‹ä¸€å¥—ä¸€è‡´çš„æ¨¡å¼å’Œæœ€ä½³å®è·µï¼Œä½¿å›¢é˜Ÿèƒ½å¤Ÿé«˜æ•ˆåœ°å¼€å‘å’Œç»´æŠ¤åº”ç”¨ã€‚é€šè¿‡åˆç†çš„å°è£…å’ŒæŠ½è±¡ï¼Œå¯ä»¥ä½¿ç½‘ç»œè¯·æ±‚ä»£ç æ›´åŠ æ¸…æ™°ã€å¯æµ‹è¯•å’Œå¯ç»´æŠ¤ã€‚